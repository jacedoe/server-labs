{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\ud83c\udfe1 Bienvenido a Server Labs \u00b6 Esta documentaci\u00f3n te guiar\u00e1 paso a paso en la creaci\u00f3n de tu infraestructura con XCP-ng , Linux y Contenedores Docker . Sigue la gu\u00eda seg\u00fan tu objetivo: despliegue de VM, contenedores o referencia de comandos \u00fatiles. \u2699\ufe0f 1. Preparaci\u00f3n de la Infraestructura \u00b6 Servidor XCP-ng: Instalaci\u00f3n de XCP-ng Despliegue VM Alpine Linux: Gu\u00eda paso a paso \ud83d\udd12 2. Despliegue en producci\u00f3n de sitio web \u00b6 Instalaci\u00f3n y configuraci\u00f3n de Nginx y Hugo Despliegue completo Configuraci\u00f3n del stack Alpine-Nginx-MariaDB-WordPress Despliegue completo Cloudflare Tunnel: Configuraci\u00f3n segura \ud83d\udee1\ufe0f 3. Contenedores docker en acci\u00f3n \u00b6 \ud83d\udcda Ap\u00e9ndices \u00b6 Comandos \u00datiles: Referencia r\u00e1pida Gu\u00eda de Estilo (Oficial): Normas de documentaci\u00f3n \ud83d\udd17 Recursos Adicionales \u00b6 Repositorio GitHub del proyecto Abrir un Issue o Pull Request \ud83d\udca1 Tip: Usa la barra de b\u00fasqueda de la p\u00e1gina para encontrar cualquier comando, archivo o secci\u00f3n.","title":"\ud83c\udfe1 Inicio"},{"location":"#bienvenido-a-server-labs","text":"Esta documentaci\u00f3n te guiar\u00e1 paso a paso en la creaci\u00f3n de tu infraestructura con XCP-ng , Linux y Contenedores Docker . Sigue la gu\u00eda seg\u00fan tu objetivo: despliegue de VM, contenedores o referencia de comandos \u00fatiles.","title":"\ud83c\udfe1 Bienvenido a Server Labs"},{"location":"#1-preparacion-de-la-infraestructura","text":"Servidor XCP-ng: Instalaci\u00f3n de XCP-ng Despliegue VM Alpine Linux: Gu\u00eda paso a paso","title":"\u2699\ufe0f 1. Preparaci\u00f3n de la Infraestructura"},{"location":"#2-despliegue-en-produccion-de-sitio-web","text":"Instalaci\u00f3n y configuraci\u00f3n de Nginx y Hugo Despliegue completo Configuraci\u00f3n del stack Alpine-Nginx-MariaDB-WordPress Despliegue completo Cloudflare Tunnel: Configuraci\u00f3n segura","title":"\ud83d\udd12 2. Despliegue en producci\u00f3n de sitio web"},{"location":"#3-contenedores-docker-en-accion","text":"","title":"\ud83d\udee1\ufe0f 3. Contenedores docker en acci\u00f3n"},{"location":"#apendices","text":"Comandos \u00datiles: Referencia r\u00e1pida Gu\u00eda de Estilo (Oficial): Normas de documentaci\u00f3n","title":"\ud83d\udcda Ap\u00e9ndices"},{"location":"#recursos-adicionales","text":"Repositorio GitHub del proyecto Abrir un Issue o Pull Request \ud83d\udca1 Tip: Usa la barra de b\u00fasqueda de la p\u00e1gina para encontrar cualquier comando, archivo o secci\u00f3n.","title":"\ud83d\udd17 Recursos Adicionales"},{"location":"apendices/comandos_utiles/","text":"\ud83d\udee0\ufe0f Comandos \u00datiles y de Referencia Este ap\u00e9ndice contiene una lista de comandos esenciales para la gesti\u00f3n diaria y la soluci\u00f3n de problemas (troubleshooting) de los componentes clave de la infraestructura. \u2699\ufe0f Gesti\u00f3n de la M\u00e1quina Virtual (XCP-ng Console) Estos comandos se ejecutan en la consola de root del servidor XCP-ng. Verificar el estado del host: xe host-list Verificar el estado de las VMs: xe vm-list Encender una VM (usando el nombre): xe vm-start vm=[Nombre de la VM] Apagar una VM (apagado limpio): xe vm-shutdown vm=[Nombre de la VM] Verificar el estado de los Storage Repositories (SR): xe sr-list 1.2. Ejemplo de redimensionamiento de una VM Alpine Linux de 20 GiB a 40 GiB Ejecutar en el host Xen xe vm-shutdown vm=VM xe vm-disk-list vm=VM xe vdi-resize uuid=VDI_UUID disk-size=40GiB xe vm-start vm=VM Ejecutar en la VM Alpine apk add util-linux e2fsprogs growpart /dev/xvda 3 resize2fs /dev/xvda3 df -h \ud83d\udc33 Gesti\u00f3n de Contenedores (Podman) Estos comandos se ejecutan dentro de la VM Debian como tu usuario est\u00e1ndar (admin), en modo rootless. Verificar todos los contenedores (activos e inactivos): podman ps -a Verificar todas las im\u00e1genes descargadas: podman images Verificar las redes de Podman: podman network ls Detener el stack completo (en el directorio del podman-compose.yml): podman-compose down Reiniciar el stack: podman-compose restart Ver logs de un contenedor (ej: WordPress): podman logs -f wordpress_app Ejecutar un comando dentro de un contenedor (ej: en NGINX): podman exec -it nginx_proxy /bin/ Limpiar contenedores y vol\u00famenes no utilizados (\u00a1Usar con precauci\u00f3n!): podman system prune \ud83d\udee1\ufe0f Cloudflared Estos comandos se ejecutan en la VM Debian para verificar el estado de los servicios. A. Cloudflare Tunnel Verificar el estado del servicio cloudflared: sudo systemctl status cloudflared Ver logs del servicio cloudflared: sudo journalctl -u cloudflared -f \ud83d\udee0\ufe0f","title":"Comandos \u00datiles"},{"location":"preparacion/instalacion_alpine/","text":"1. Despliegue VM Alpine Linux \u00b6 Este apartado describe el proceso completo para desplegar una m\u00e1quina virtual con Alpine Linux sobre un servidor XCP-ng, as\u00ed como su configuraci\u00f3n inicial para dejarla lista para administraci\u00f3n remota y uso de contenedores con Docker. 2. Requisitos previos \u00b6 Antes de comenzar, aseg\u00farate de contar con: Servidor XCP-ng correctamente instalado y operativo Acceso a Xen Orchestra (XO Lite o completo) Imagen ISO de Alpine Linux (Standard x86_64) Conectividad de red funcional Conocimientos b\u00e1sicos de consola Linux 3. Creaci\u00f3n de la m\u00e1quina virtual en XCP-ng \u00b6 Accede a Xen Orchestra Selecciona New VM Elige la plantilla: Other install media Asigna los recursos recomendados: CPU: 1\u20132 vCPU RAM: 512 MB (m\u00ednimo) / 1 GB recomendado Disco: 8\u201316 GB Adjunta la ISO de Alpine Linux Configura la interfaz de red (bridge por defecto) Finaliza y arranca la VM 4. Instalaci\u00f3n base de Alpine Linux \u00b6 En la consola de la VM, inicia sesi\u00f3n como: login: root Ejecuta el instalador: setup-alpine Responde a las preguntas principales: Teclado: es o us Hostname: (ej. alpine-vm) Red: DHCP (recomendado) Zona horaria: Europe/Madrid (o la correspondiente) Repositorio: por defecto Disco: sys Modo: standard Confirma la instalaci\u00f3n y espera a que finalice. Reinicia el sistema: reboot 5. Configuraci\u00f3n del acceso por SSH \u00b6 Instala el servidor OpenSSH: apk add openssh Habilita el servicio: rc-update add sshd rc-service sshd start Verifica que el servicio est\u00e9 activo: rc-service sshd status (Opcional pero recomendado) Edita la configuraci\u00f3n: vi /etc/ssh/sshd_config Aseg\u00farate de: PermitRootLogin no PasswordAuthentication yes Reinicia SSH: rc-service sshd restart 6. Creaci\u00f3n de un nuevo usuario \u00b6 Crea un usuario (ejemplo: admin): adduser admin A\u00f1\u00e1delo a los grupos necesarios: addgroup admin wheel Verifica: id admin 7. Configuraci\u00f3n de doas (sudo en Alpine) \u00b6 Alpine utiliza doas en lugar de sudo. Instala doas: apk add doas Edita el archivo de configuraci\u00f3n: vi /etc/doas.conf A\u00f1ade la siguiente l\u00ednea: permit persist :wheel Asegura permisos correctos: chmod 0400 /etc/doas.conf Cambia al nuevo usuario y prueba: su - admin doas apk update 8. Instalaci\u00f3n de herramientas b\u00e1sicas \u00b6 Instala utilidades comunes para administraci\u00f3n: doas apk add \\ curl \\ wget \\ vim \\ btop \\ bash \\ git \\ ca-certificates Establece Bash como shell por defecto (opcional): doas chsh -s /bin/bash admin 9. Instalaci\u00f3n y configuraci\u00f3n de Docker \u00b6 Instala Docker: doas apk add docker Habilita el servicio: doas rc-update add docker doas rc-service docker start A\u00f1ade el usuario al grupo docker: doas addgroup admin docker Cierra sesi\u00f3n y vuelve a entrar para aplicar cambios. Verifica la instalaci\u00f3n: docker version docker run hello-world 10. Configuraci\u00f3n final recomendada \u00b6 Actualiza el sistema: doas apk update && doas apk upgrade Configura IP est\u00e1tica (opcional): vi /etc/network/interfaces","title":"1.2. Despliegue VM Alpine LInux"},{"location":"preparacion/instalacion_alpine/#1-despliegue-vm-alpine-linux","text":"Este apartado describe el proceso completo para desplegar una m\u00e1quina virtual con Alpine Linux sobre un servidor XCP-ng, as\u00ed como su configuraci\u00f3n inicial para dejarla lista para administraci\u00f3n remota y uso de contenedores con Docker.","title":"1. Despliegue VM Alpine Linux"},{"location":"preparacion/instalacion_alpine/#2-requisitos-previos","text":"Antes de comenzar, aseg\u00farate de contar con: Servidor XCP-ng correctamente instalado y operativo Acceso a Xen Orchestra (XO Lite o completo) Imagen ISO de Alpine Linux (Standard x86_64) Conectividad de red funcional Conocimientos b\u00e1sicos de consola Linux","title":"2. Requisitos previos"},{"location":"preparacion/instalacion_alpine/#3-creacion-de-la-maquina-virtual-en-xcp-ng","text":"Accede a Xen Orchestra Selecciona New VM Elige la plantilla: Other install media Asigna los recursos recomendados: CPU: 1\u20132 vCPU RAM: 512 MB (m\u00ednimo) / 1 GB recomendado Disco: 8\u201316 GB Adjunta la ISO de Alpine Linux Configura la interfaz de red (bridge por defecto) Finaliza y arranca la VM","title":"3. Creaci\u00f3n de la m\u00e1quina virtual en XCP-ng"},{"location":"preparacion/instalacion_alpine/#4-instalacion-base-de-alpine-linux","text":"En la consola de la VM, inicia sesi\u00f3n como: login: root Ejecuta el instalador: setup-alpine Responde a las preguntas principales: Teclado: es o us Hostname: (ej. alpine-vm) Red: DHCP (recomendado) Zona horaria: Europe/Madrid (o la correspondiente) Repositorio: por defecto Disco: sys Modo: standard Confirma la instalaci\u00f3n y espera a que finalice. Reinicia el sistema: reboot","title":"4. Instalaci\u00f3n base de Alpine Linux"},{"location":"preparacion/instalacion_alpine/#5-configuracion-del-acceso-por-ssh","text":"Instala el servidor OpenSSH: apk add openssh Habilita el servicio: rc-update add sshd rc-service sshd start Verifica que el servicio est\u00e9 activo: rc-service sshd status (Opcional pero recomendado) Edita la configuraci\u00f3n: vi /etc/ssh/sshd_config Aseg\u00farate de: PermitRootLogin no PasswordAuthentication yes Reinicia SSH: rc-service sshd restart","title":"5. Configuraci\u00f3n del acceso por SSH"},{"location":"preparacion/instalacion_alpine/#6-creacion-de-un-nuevo-usuario","text":"Crea un usuario (ejemplo: admin): adduser admin A\u00f1\u00e1delo a los grupos necesarios: addgroup admin wheel Verifica: id admin","title":"6. Creaci\u00f3n de un nuevo usuario"},{"location":"preparacion/instalacion_alpine/#7-configuracion-de-doas-sudo-en-alpine","text":"Alpine utiliza doas en lugar de sudo. Instala doas: apk add doas Edita el archivo de configuraci\u00f3n: vi /etc/doas.conf A\u00f1ade la siguiente l\u00ednea: permit persist :wheel Asegura permisos correctos: chmod 0400 /etc/doas.conf Cambia al nuevo usuario y prueba: su - admin doas apk update","title":"7. Configuraci\u00f3n de doas (sudo en Alpine)"},{"location":"preparacion/instalacion_alpine/#8-instalacion-de-herramientas-basicas","text":"Instala utilidades comunes para administraci\u00f3n: doas apk add \\ curl \\ wget \\ vim \\ btop \\ bash \\ git \\ ca-certificates Establece Bash como shell por defecto (opcional): doas chsh -s /bin/bash admin","title":"8. Instalaci\u00f3n de herramientas b\u00e1sicas"},{"location":"preparacion/instalacion_alpine/#9-instalacion-y-configuracion-de-docker","text":"Instala Docker: doas apk add docker Habilita el servicio: doas rc-update add docker doas rc-service docker start A\u00f1ade el usuario al grupo docker: doas addgroup admin docker Cierra sesi\u00f3n y vuelve a entrar para aplicar cambios. Verifica la instalaci\u00f3n: docker version docker run hello-world","title":"9. Instalaci\u00f3n y configuraci\u00f3n de Docker"},{"location":"preparacion/instalacion_alpine/#10-configuracion-final-recomendada","text":"Actualiza el sistema: doas apk update && doas apk upgrade Configura IP est\u00e1tica (opcional): vi /etc/network/interfaces","title":"10. Configuraci\u00f3n final recomendada"},{"location":"preparacion/instalacion_xo_lite/","text":"\u2699\ufe0f Instalaci\u00f3n y Configuraci\u00f3n del Servidor XCP-ng \u00b6 Esta gu\u00eda detalla el proceso para establecer la plataforma de virtualizaci\u00f3n utilizando XCP-ng , la interfaz web ligera y moderna para gestionar el hypervisor XCP-ng (o XenServer). Nota: XCP-ng no es el hypervisor , sino la interfaz de gesti\u00f3n. Primero se instala XCP-ng y luego se accede a su interfaz web integrada. \ud83d\udccb 1. Prerrequisitos \u00b6 Antes de comenzar, aseg\u00farate de contar con: Un servidor f\u00edsico o m\u00e1quina virtual para instalar el hypervisor XCP-ng. Medios de instalaci\u00f3n de XCP-ng (USB o ISO). Acceso a la red local. Importante Guarda cuidadosamente la contrase\u00f1a de root que establecer\u00e1s durante la instalaci\u00f3n. Ser\u00e1 esencial para la gesti\u00f3n del servidor. \ud83d\udda5\ufe0f 2. Instalaci\u00f3n del Hypervisor XCP-ng \u00b6 La instalaci\u00f3n del hypervisor es el paso fundamental para acceder a XCP-ng. 3. Arranque desde el medio de instalaci\u00f3n \u00b6 Inicia el servidor usando la imagen ISO o USB de XCP-ng. El asistente te guiar\u00e1 paso a paso: Selecciona el idioma y la distribuci\u00f3n del teclado. Acepta el acuerdo de licencia (EULA) . Selecciona el disco donde se instalar\u00e1 el sistema operativo del hypervisor. Configura la contrase\u00f1a de root . Configura la red (se recomienda IP est\u00e1tica para servidores). Configura la zona horaria . Finalizaci\u00f3n: el sistema instalar\u00e1 los archivos y te pedir\u00e1 retirar el medio y reiniciar. \ud83c\udf10 4. Acceso Inicial a la Interfaz XCP-ng \u00b6 Tras reiniciar el servidor: 5. Obtener la Direcci\u00f3n IP \u00b6 La consola de XCP-ng mostrar\u00e1 la IP asignada (ejemplo: 192.168.1.10 ). 6. Acceder desde el navegador \u00b6 Abre un navegador web y navega a: https://192.168.1.10 Certificado autofirmado Es probable que tu navegador muestre una advertencia de seguridad. Acepta el certificado para continuar. 7. Inicio de sesi\u00f3n en XCP-ng \u00b6 Usuario: root Contrase\u00f1a: La que configuraste durante la instalaci\u00f3n de XCP-ng \u2699\ufe0f 8. Configuraci\u00f3n Post-Instalaci\u00f3n en XCP-ng \u00b6 Dentro de XCP-ng, realiza estas configuraciones b\u00e1sicas: 9. Configuraci\u00f3n de Red \u00b6 Verifica que la interfaz de red (NIC) tenga la IP, m\u00e1scara y gateway correctos. Configura redes virtuales o VLANs si es necesario. 10. Configuraci\u00f3n de Almacenamiento (Storage) \u00b6 Crea un SR (Storage Repository) para alojar las m\u00e1quinas virtuales. Ejemplos de opciones comunes: LVM Local (disco f\u00edsico dedicado) NFS o SMB (almacenamiento en red) Tip Si instalaste en un disco peque\u00f1o y tienes un disco m\u00e1s grande para VMs, crea un SR separado en ese disco para optimizar el rendimiento. 11. Actualizaciones \u00b6 XCP-ng facilita la aplicaci\u00f3n de parches y actualizaciones del hypervisor. Aseg\u00farate de que XCP-ng est\u00e9 actualizado antes de desplegar tus VMs. \u2705 Con la instalaci\u00f3n y configuraci\u00f3n b\u00e1sica de XCP-ng completada, tu hypervisor XCP-ng est\u00e1 listo para administrar m\u00e1quinas virtuales de forma eficiente y segura. \u27a1\ufe0f Siguiente paso recomendado: Contin\u00faa con la preparaci\u00f3n del entorno para contenedores: Preparaci\u00f3n de Podman","title":"1.1. Servidor XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#instalacion-y-configuracion-del-servidor-xcp-ng","text":"Esta gu\u00eda detalla el proceso para establecer la plataforma de virtualizaci\u00f3n utilizando XCP-ng , la interfaz web ligera y moderna para gestionar el hypervisor XCP-ng (o XenServer). Nota: XCP-ng no es el hypervisor , sino la interfaz de gesti\u00f3n. Primero se instala XCP-ng y luego se accede a su interfaz web integrada.","title":"\u2699\ufe0f Instalaci\u00f3n y Configuraci\u00f3n del Servidor XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#1-prerrequisitos","text":"Antes de comenzar, aseg\u00farate de contar con: Un servidor f\u00edsico o m\u00e1quina virtual para instalar el hypervisor XCP-ng. Medios de instalaci\u00f3n de XCP-ng (USB o ISO). Acceso a la red local. Importante Guarda cuidadosamente la contrase\u00f1a de root que establecer\u00e1s durante la instalaci\u00f3n. Ser\u00e1 esencial para la gesti\u00f3n del servidor.","title":"\ud83d\udccb 1. Prerrequisitos"},{"location":"preparacion/instalacion_xo_lite/#2-instalacion-del-hypervisor-xcp-ng","text":"La instalaci\u00f3n del hypervisor es el paso fundamental para acceder a XCP-ng.","title":"\ud83d\udda5\ufe0f 2. Instalaci\u00f3n del Hypervisor XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#3-arranque-desde-el-medio-de-instalacion","text":"Inicia el servidor usando la imagen ISO o USB de XCP-ng. El asistente te guiar\u00e1 paso a paso: Selecciona el idioma y la distribuci\u00f3n del teclado. Acepta el acuerdo de licencia (EULA) . Selecciona el disco donde se instalar\u00e1 el sistema operativo del hypervisor. Configura la contrase\u00f1a de root . Configura la red (se recomienda IP est\u00e1tica para servidores). Configura la zona horaria . Finalizaci\u00f3n: el sistema instalar\u00e1 los archivos y te pedir\u00e1 retirar el medio y reiniciar.","title":"3. Arranque desde el medio de instalaci\u00f3n"},{"location":"preparacion/instalacion_xo_lite/#4-acceso-inicial-a-la-interfaz-xcp-ng","text":"Tras reiniciar el servidor:","title":"\ud83c\udf10 4. Acceso Inicial a la Interfaz XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#5-obtener-la-direccion-ip","text":"La consola de XCP-ng mostrar\u00e1 la IP asignada (ejemplo: 192.168.1.10 ).","title":"5. Obtener la Direcci\u00f3n IP"},{"location":"preparacion/instalacion_xo_lite/#6-acceder-desde-el-navegador","text":"Abre un navegador web y navega a: https://192.168.1.10 Certificado autofirmado Es probable que tu navegador muestre una advertencia de seguridad. Acepta el certificado para continuar.","title":"6. Acceder desde el navegador"},{"location":"preparacion/instalacion_xo_lite/#7-inicio-de-sesion-en-xcp-ng","text":"Usuario: root Contrase\u00f1a: La que configuraste durante la instalaci\u00f3n de XCP-ng","title":"7. Inicio de sesi\u00f3n en XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#8-configuracion-post-instalacion-en-xcp-ng","text":"Dentro de XCP-ng, realiza estas configuraciones b\u00e1sicas:","title":"\u2699\ufe0f 8. Configuraci\u00f3n Post-Instalaci\u00f3n en XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#9-configuracion-de-red","text":"Verifica que la interfaz de red (NIC) tenga la IP, m\u00e1scara y gateway correctos. Configura redes virtuales o VLANs si es necesario.","title":"9. Configuraci\u00f3n de Red"},{"location":"preparacion/instalacion_xo_lite/#10-configuracion-de-almacenamiento-storage","text":"Crea un SR (Storage Repository) para alojar las m\u00e1quinas virtuales. Ejemplos de opciones comunes: LVM Local (disco f\u00edsico dedicado) NFS o SMB (almacenamiento en red) Tip Si instalaste en un disco peque\u00f1o y tienes un disco m\u00e1s grande para VMs, crea un SR separado en ese disco para optimizar el rendimiento.","title":"10. Configuraci\u00f3n de Almacenamiento (Storage)"},{"location":"preparacion/instalacion_xo_lite/#11-actualizaciones","text":"XCP-ng facilita la aplicaci\u00f3n de parches y actualizaciones del hypervisor. Aseg\u00farate de que XCP-ng est\u00e9 actualizado antes de desplegar tus VMs. \u2705 Con la instalaci\u00f3n y configuraci\u00f3n b\u00e1sica de XCP-ng completada, tu hypervisor XCP-ng est\u00e1 listo para administrar m\u00e1quinas virtuales de forma eficiente y segura. \u27a1\ufe0f Siguiente paso recomendado: Contin\u00faa con la preparaci\u00f3n del entorno para contenedores: Preparaci\u00f3n de Podman","title":"11. Actualizaciones"},{"location":"seguridad/cloudflare_tunnel/","text":"Para cerrar el c\u00edrculo de tu infraestructura en Alpine Linux, el t\u00fanel de Cloudflare (cloudflared) es la pieza clave: es lo que permite que tu servidor sea accesible desde internet sin abrir puertos en tu router y gestionando el SSL de forma autom\u00e1tica. Al no usar contenedores, instalaremos el binario de forma nativa y lo configuraremos como un servicio de OpenRC. \ud83d\udee0\ufe0f Gu\u00eda de Instalaci\u00f3n: Cloudflare Tunnel en Alpine Linux 1. Instalaci\u00f3n del binario Alpine no siempre tiene la versi\u00f3n m\u00e1s reciente en sus repositorios oficiales, por lo que lo ideal es descargar el binario directamente de Cloudflare. Bash Instalar dependencias necesarias \u00b6 apk add libc6-compat Descargar el binario (arquitectura x86_64 para XCP-ng) \u00b6 wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64 Mover y dar permisos \u00b6 chmod +x cloudflared-linux-amd64 mv cloudflared-linux-amd64 /usr/local/bin/cloudflared Verificar instalaci\u00f3n \u00b6 cloudflared --version Autenticaci\u00f3n y Creaci\u00f3n del T\u00fanel Desde la terminal de tu servidor, ejecuta el login (esto te dar\u00e1 un enlace que debes abrir en tu navegador): Bash cloudflared tunnel login Una vez autorizado, crea el t\u00fanel para tu infraestructura: Bash Nombre sugerido: server-labs \u00b6 cloudflared tunnel create server-labs Esto generar\u00e1 un archivo .json en ~/.cloudflared/. Anota el ID del t\u00fanel. 3. Configuraci\u00f3n del archivo config.yml Crea el archivo de configuraci\u00f3n que redirigir\u00e1 el tr\u00e1fico a los puertos de Nginx que definimos antes: Bash mkdir -p /etc/cloudflared vi /etc/cloudflared/config.yml Contenido del archivo: YAML tunnel: TU_TUNNEL_ID credentials-file: /etc/cloudflared/TU_TUNNEL_ID.json ingress: # Sitio principal (Hugo) - hostname: merceponsautora.com service: http://localhost:8080 - hostname: www.merceponsautora.com service: http://localhost:8080 # Blog (WordPress) - hostname: blog.merceponsautora.com service: http://localhost:80 # Regla por defecto (404 si no coincide nada) - service: http_status:404 No olvides mover el archivo .json de credenciales a /etc/cloudflared/ para que sea accesible globalmente. 4. Configuraci\u00f3n como Servicio nativo (OpenRC) Para que el t\u00fanel arranque solo al iniciar la VM en XCP-ng, crearemos un script de servicio para Alpine. Crea el archivo de servicio: vi /etc/init.d/cloudflared Pega este contenido: Bash !/sbin/openrc-run \u00b6 name=\"cloudflared\" description=\"Cloudflare Tunnel\" command=\"/usr/local/bin/cloudflared\" command_args=\"tunnel --config /etc/cloudflared/config.yml run\" command_background=\"yes\" pidfile=\"/run/${RC_SVCNAME}.pid\" output_log=\"/var/log/cloudflared.log\" error_log=\"/var/log/cloudflared.err\" depend() { need net after firewall } Da permisos y activa el servicio: Bash chmod +x /etc/init.d/cloudflared rc-update add cloudflared default rc-service cloudflared start Configuraci\u00f3n en el Panel de Cloudflare (DNS) El \u00faltimo paso es decirle a Cloudflare que use el t\u00fanel para tus dominios. Puedes hacerlo desde la web de Cloudflare o por comando: Bash cloudflared tunnel route dns server-labs merceponsautora.com cloudflared tunnel route dns server-labs blog.merceponsautora.com","title":"2.3. Cloudflare Tunnel"},{"location":"seguridad/cloudflare_tunnel/#instalar-dependencias-necesarias","text":"apk add libc6-compat","title":"Instalar dependencias necesarias"},{"location":"seguridad/cloudflare_tunnel/#descargar-el-binario-arquitectura-x86_64-para-xcp-ng","text":"wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64","title":"Descargar el binario (arquitectura x86_64 para XCP-ng)"},{"location":"seguridad/cloudflare_tunnel/#mover-y-dar-permisos","text":"chmod +x cloudflared-linux-amd64 mv cloudflared-linux-amd64 /usr/local/bin/cloudflared","title":"Mover y dar permisos"},{"location":"seguridad/cloudflare_tunnel/#verificar-instalacion","text":"cloudflared --version Autenticaci\u00f3n y Creaci\u00f3n del T\u00fanel Desde la terminal de tu servidor, ejecuta el login (esto te dar\u00e1 un enlace que debes abrir en tu navegador): Bash cloudflared tunnel login Una vez autorizado, crea el t\u00fanel para tu infraestructura: Bash","title":"Verificar instalaci\u00f3n"},{"location":"seguridad/cloudflare_tunnel/#nombre-sugerido-server-labs","text":"cloudflared tunnel create server-labs Esto generar\u00e1 un archivo .json en ~/.cloudflared/. Anota el ID del t\u00fanel. 3. Configuraci\u00f3n del archivo config.yml Crea el archivo de configuraci\u00f3n que redirigir\u00e1 el tr\u00e1fico a los puertos de Nginx que definimos antes: Bash mkdir -p /etc/cloudflared vi /etc/cloudflared/config.yml Contenido del archivo: YAML tunnel: TU_TUNNEL_ID credentials-file: /etc/cloudflared/TU_TUNNEL_ID.json ingress: # Sitio principal (Hugo) - hostname: merceponsautora.com service: http://localhost:8080 - hostname: www.merceponsautora.com service: http://localhost:8080 # Blog (WordPress) - hostname: blog.merceponsautora.com service: http://localhost:80 # Regla por defecto (404 si no coincide nada) - service: http_status:404 No olvides mover el archivo .json de credenciales a /etc/cloudflared/ para que sea accesible globalmente. 4. Configuraci\u00f3n como Servicio nativo (OpenRC) Para que el t\u00fanel arranque solo al iniciar la VM en XCP-ng, crearemos un script de servicio para Alpine. Crea el archivo de servicio: vi /etc/init.d/cloudflared Pega este contenido: Bash","title":"Nombre sugerido: server-labs"},{"location":"seguridad/cloudflare_tunnel/#sbinopenrc-run","text":"name=\"cloudflared\" description=\"Cloudflare Tunnel\" command=\"/usr/local/bin/cloudflared\" command_args=\"tunnel --config /etc/cloudflared/config.yml run\" command_background=\"yes\" pidfile=\"/run/${RC_SVCNAME}.pid\" output_log=\"/var/log/cloudflared.log\" error_log=\"/var/log/cloudflared.err\" depend() { need net after firewall } Da permisos y activa el servicio: Bash chmod +x /etc/init.d/cloudflared rc-update add cloudflared default rc-service cloudflared start Configuraci\u00f3n en el Panel de Cloudflare (DNS) El \u00faltimo paso es decirle a Cloudflare que use el t\u00fanel para tus dominios. Puedes hacerlo desde la web de Cloudflare o por comando: Bash cloudflared tunnel route dns server-labs merceponsautora.com cloudflared tunnel route dns server-labs blog.merceponsautora.com","title":"!/sbin/openrc-run"},{"location":"web/despliegue_stack_web/","text":"\ud83d\udcdd Gu\u00eda de Despliegue: WordPress + PHP 8.4 en Alpine Linux Esta gu\u00eda detalla la instalaci\u00f3n del stack din\u00e1mico para blog.merceponsautora.com. 1. Instalaci\u00f3n de PHP 8.4 y Extensiones Alpine es modular. Para que WordPress funcione correctamente, necesitamos el motor de PHP y sus extensiones de procesamiento de im\u00e1genes y base de datos. Bash Actualizar repositorios \u00b6 apk update Instalar PHP 8.4 y m\u00f3dulos necesarios \u00b6 apk add php84 php84-fpm php84-mysqli php84-json php84-openssl php84-curl \\ php84-zlib php84-xml php84-phar php84-intl php84-dom php84-xmlreader \\ php84-ctype php84-session php84-mbstring php84-gd php84-iconv Configuraci\u00f3n de PHP-FPM (El Socket) Para que coincida con tu configuraci\u00f3n de Nginx, debemos decirle a PHP que escuche en el archivo de socket que definiste: /var/run/php-fpm84.sock. Edita el archivo de configuraci\u00f3n: vi /etc/php84/php-fpm.d/www.conf Modifica estas l\u00edneas: Ini, TOML listen = /var/run/php-fpm84.sock listen.owner = nginx listen.group = nginx listen.mode = 0660 Habilita y arranca el servicio: Bash rc-update add php-fpm84 default rc-service php-fpm84 start Base de Datos (MariaDB) Instalaremos MariaDB de forma nativa para gestionar el contenido del blog. Bash Instalar MariaDB \u00b6 apk add mariadb mariadb-client Configurar directorios e instalar base de datos inicial \u00b6 mysql_install_db --user=mysql --datadir=/var/lib/mysql Arrancar servicio \u00b6 rc-update add mariadb default rc-service mariadb start Configuraci\u00f3n de seguridad (poner password de root) \u00b6 mysql_secure_installation Crear la base de datos para el blog: SQL -- Accede con: mysql -u root -p CREATE DATABASE db_mercepons_blog; CREATE USER 'user_blog'@'localhost' IDENTIFIED BY 'tu_password_seguro'; GRANT ALL PRIVILEGES ON db_mercepons_blog.* TO 'user_blog'@'localhost'; FLUSH PRIVILEGES; EXIT; Instalaci\u00f3n de WordPress Descargamos la \u00faltima versi\u00f3n directamente en la ruta que definiste en tu Nginx (/var/www/blog). Bash Crear directorio y descargar \u00b6 mkdir -p /var/www/blog cd /var/www/blog wget https://wordpress.org/latest.tar.gz tar -xzvf latest.tar.gz --strip-components=1 rm latest.tar.gz Configurar permisos para que Nginx y PHP puedan escribir (subir fotos, etc) \u00b6 chown -R nginx:nginx /var/www/blog Configuraci\u00f3n del wp-config.php Crea el archivo de configuraci\u00f3n uniendo WordPress con tu base de datos: Bash cp wp-config-sample.php wp-config.php vi wp-config.php Ajusta los valores con el nombre de la DB y el usuario que creamos en el paso 3.","title":"2.2. Configuraci\u00f3n del stack Nginx-MariaDB-WordPress"},{"location":"web/despliegue_stack_web/#actualizar-repositorios","text":"apk update","title":"Actualizar repositorios"},{"location":"web/despliegue_stack_web/#instalar-php-84-y-modulos-necesarios","text":"apk add php84 php84-fpm php84-mysqli php84-json php84-openssl php84-curl \\ php84-zlib php84-xml php84-phar php84-intl php84-dom php84-xmlreader \\ php84-ctype php84-session php84-mbstring php84-gd php84-iconv Configuraci\u00f3n de PHP-FPM (El Socket) Para que coincida con tu configuraci\u00f3n de Nginx, debemos decirle a PHP que escuche en el archivo de socket que definiste: /var/run/php-fpm84.sock. Edita el archivo de configuraci\u00f3n: vi /etc/php84/php-fpm.d/www.conf Modifica estas l\u00edneas: Ini, TOML listen = /var/run/php-fpm84.sock listen.owner = nginx listen.group = nginx listen.mode = 0660 Habilita y arranca el servicio: Bash rc-update add php-fpm84 default rc-service php-fpm84 start Base de Datos (MariaDB) Instalaremos MariaDB de forma nativa para gestionar el contenido del blog. Bash","title":"Instalar PHP 8.4 y m\u00f3dulos necesarios"},{"location":"web/despliegue_stack_web/#instalar-mariadb","text":"apk add mariadb mariadb-client","title":"Instalar MariaDB"},{"location":"web/despliegue_stack_web/#configurar-directorios-e-instalar-base-de-datos-inicial","text":"mysql_install_db --user=mysql --datadir=/var/lib/mysql","title":"Configurar directorios e instalar base de datos inicial"},{"location":"web/despliegue_stack_web/#arrancar-servicio","text":"rc-update add mariadb default rc-service mariadb start","title":"Arrancar servicio"},{"location":"web/despliegue_stack_web/#configuracion-de-seguridad-poner-password-de-root","text":"mysql_secure_installation Crear la base de datos para el blog: SQL -- Accede con: mysql -u root -p CREATE DATABASE db_mercepons_blog; CREATE USER 'user_blog'@'localhost' IDENTIFIED BY 'tu_password_seguro'; GRANT ALL PRIVILEGES ON db_mercepons_blog.* TO 'user_blog'@'localhost'; FLUSH PRIVILEGES; EXIT; Instalaci\u00f3n de WordPress Descargamos la \u00faltima versi\u00f3n directamente en la ruta que definiste en tu Nginx (/var/www/blog). Bash","title":"Configuraci\u00f3n de seguridad (poner password de root)"},{"location":"web/despliegue_stack_web/#crear-directorio-y-descargar","text":"mkdir -p /var/www/blog cd /var/www/blog wget https://wordpress.org/latest.tar.gz tar -xzvf latest.tar.gz --strip-components=1 rm latest.tar.gz","title":"Crear directorio y descargar"},{"location":"web/despliegue_stack_web/#configurar-permisos-para-que-nginx-y-php-puedan-escribir-subir-fotos-etc","text":"chown -R nginx:nginx /var/www/blog Configuraci\u00f3n del wp-config.php Crea el archivo de configuraci\u00f3n uniendo WordPress con tu base de datos: Bash cp wp-config-sample.php wp-config.php vi wp-config.php Ajusta los valores con el nombre de la DB y el usuario que creamos en el paso 3.","title":"Configurar permisos para que Nginx y PHP puedan escribir (subir fotos, etc)"},{"location":"web/nginx_conf/","text":"\ud83c\udf10 Arquitectura de Servidor: Merce Pons Esta secci\u00f3n documenta la implementaci\u00f3n nativa en Alpine Linux para la infraestructura de la escritora Merce Pons. Esquema de Flujo de Datos 1. Configuraci\u00f3n de Nginx La configuraci\u00f3n se divide en dos bloques l\u00f3gicos para optimizar el rendimiento y la seguridad. A. Sitio Principal (Hugo - Est\u00e1tico) Puerto: 8080 (Configurado para recibir tr\u00e1fico del T\u00fanel de Cloudflare). Directorio ra\u00edz: /var/www/mercepons/public. Estrategia: Entrega directa de archivos con fallback 404. Al ser Hugo, no requiere procesamiento de lenguaje de lado del servidor, lo que garantiza una carga instant\u00e1nea. B. Blog (WordPress - Din\u00e1mico) Puerto: 80. Procesamiento PHP: Se utiliza PHP-FPM 8.4 a trav\u00e9s de un socket Unix (/var/run/php-fpm84.sock), lo cual es m\u00e1s eficiente que TCP en instalaciones nativas de Alpine. Par\u00e1metros Cr\u00edticos de Proxy: * fastcgi_param HTTPS on;: Crucial para evitar bucles de redirecci\u00f3n (Mixed Content) ya que SSL termina en Cloudflare. HTTP_X_FORWARDED_PROTO: Permite que WordPress reconozca que el usuario final navega de forma segura. Manual de Mantenimiento (SysAdmin) Gesti\u00f3n de Servicios en Alpine (OpenRC) Para reiniciar o aplicar cambios en la configuraci\u00f3n: Bash Reiniciar Nginx tras cambios en la config \u00b6 rc-service nginx restart Verificar que el socket de PHP-FPM est\u00e9 activo \u00b6 ls -l /var/run/php-fpm84.sock Logs de error en tiempo real \u00b6 tail -f /var/log/nginx/error.log Despliegue de Actualizaciones Hugo: Al ejecutar hugo en tu entorno de desarrollo, el contenido se sincroniza con /var/www/mercepons/public. WordPress: El n\u00facleo y plugins se mantienen mediante el panel o wp-cli nativo en Alpine. Optimizaciones Implementadas Cach\u00e9 Agresiva: Se ha configurado un tiempo de expiraci\u00f3n m\u00e1ximo (expires max) para archivos est\u00e1ticos (js, css, im\u00e1genes), reduciendo la latencia y el ancho de banda del servidor. Seguridad: Bloqueo expl\u00edcito de archivos .htaccess y archivos ocultos, reduciendo la superficie de ataque. Silencio de Logs: Se desactivan los logs para favicon.ico y robots.txt para evitar el llenado innecesario de archivos de log. \ud83d\udee0\ufe0f Paso 1: Instalaci\u00f3n del paquete Como Alpine es minimalista, primero aseg\u00farate de tener los repositorios actualizados. Bash Actualizar \u00edndices de paquetes \u00b6 apk update Instalar nginx \u00b6 apk add nginx \u2699\ufe0f Paso 2: Gesti\u00f3n del Servicio (OpenRC) Alpine no usa systemd, usa OpenRC. Estos son los comandos que necesitas para que Nginx arranque siempre con el servidor: Bash A\u00f1adir Nginx al inicio autom\u00e1tico \u00b6 rc-update add nginx default Iniciar el servicio por primera vez \u00b6 rc-service nginx start Comprobar el estado \u00b6 rc-service nginx status \ud83d\udcc2 Paso 3: Estructura de archivos en Alpine A diferencia de Debian/Ubuntu, Alpine organiza los archivos de forma ligeramente distinta: Configuraci\u00f3n principal: /etc/nginx/nginx.conf Configuraciones de sitios: /etc/nginx/http.d/ (Aqu\u00ed es donde debes crear tus archivos .conf como el de Merce Pons). Logs: /var/log/nginx/ Directorio web por defecto: /var/lib/nginx/html (Aunque t\u00fa est\u00e1s usando /var/www/). \ud83d\udc64 Paso 4: Usuarios y Permisos Nginx en Alpine corre bajo el usuario nginx por defecto. Para que pueda leer tus carpetas de Hugo y WordPress: Bash Aseg\u00farate de que el usuario nginx tiene acceso a tus webs \u00b6 chown -R nginx:nginx /var/www/mercepons chown -R nginx:nginx /var/www/blog Permisos recomendados para directorios y archivos \u00b6 find /var/www/ -type d -exec chmod 755 {} \\; find /var/www/ -type f -exec chmod 644 {} \\; \ud83d\ude80 Paso 5: Verificaci\u00f3n y Carga Cada vez que edites tu configuraci\u00f3n (como el archivo que me pasaste antes), nunca reinicies sin probar primero: Bash Verificar sintaxis (esto te ahorra muchos dolores de cabeza) \u00b6 nginx -t Si el test es exitoso, recarga sin cortar conexiones activas \u00b6 nginx -s reload","title":"2.1. Intalaci\u00f3n de Nginx y Hugo"},{"location":"web/nginx_conf/#reiniciar-nginx-tras-cambios-en-la-config","text":"rc-service nginx restart","title":"Reiniciar Nginx tras cambios en la config"},{"location":"web/nginx_conf/#verificar-que-el-socket-de-php-fpm-este-activo","text":"ls -l /var/run/php-fpm84.sock","title":"Verificar que el socket de PHP-FPM est\u00e9 activo"},{"location":"web/nginx_conf/#logs-de-error-en-tiempo-real","text":"tail -f /var/log/nginx/error.log Despliegue de Actualizaciones Hugo: Al ejecutar hugo en tu entorno de desarrollo, el contenido se sincroniza con /var/www/mercepons/public. WordPress: El n\u00facleo y plugins se mantienen mediante el panel o wp-cli nativo en Alpine. Optimizaciones Implementadas Cach\u00e9 Agresiva: Se ha configurado un tiempo de expiraci\u00f3n m\u00e1ximo (expires max) para archivos est\u00e1ticos (js, css, im\u00e1genes), reduciendo la latencia y el ancho de banda del servidor. Seguridad: Bloqueo expl\u00edcito de archivos .htaccess y archivos ocultos, reduciendo la superficie de ataque. Silencio de Logs: Se desactivan los logs para favicon.ico y robots.txt para evitar el llenado innecesario de archivos de log. \ud83d\udee0\ufe0f Paso 1: Instalaci\u00f3n del paquete Como Alpine es minimalista, primero aseg\u00farate de tener los repositorios actualizados. Bash","title":"Logs de error en tiempo real"},{"location":"web/nginx_conf/#actualizar-indices-de-paquetes","text":"apk update","title":"Actualizar \u00edndices de paquetes"},{"location":"web/nginx_conf/#instalar-nginx","text":"apk add nginx \u2699\ufe0f Paso 2: Gesti\u00f3n del Servicio (OpenRC) Alpine no usa systemd, usa OpenRC. Estos son los comandos que necesitas para que Nginx arranque siempre con el servidor: Bash","title":"Instalar nginx"},{"location":"web/nginx_conf/#anadir-nginx-al-inicio-automatico","text":"rc-update add nginx default","title":"A\u00f1adir Nginx al inicio autom\u00e1tico"},{"location":"web/nginx_conf/#iniciar-el-servicio-por-primera-vez","text":"rc-service nginx start","title":"Iniciar el servicio por primera vez"},{"location":"web/nginx_conf/#comprobar-el-estado","text":"rc-service nginx status \ud83d\udcc2 Paso 3: Estructura de archivos en Alpine A diferencia de Debian/Ubuntu, Alpine organiza los archivos de forma ligeramente distinta: Configuraci\u00f3n principal: /etc/nginx/nginx.conf Configuraciones de sitios: /etc/nginx/http.d/ (Aqu\u00ed es donde debes crear tus archivos .conf como el de Merce Pons). Logs: /var/log/nginx/ Directorio web por defecto: /var/lib/nginx/html (Aunque t\u00fa est\u00e1s usando /var/www/). \ud83d\udc64 Paso 4: Usuarios y Permisos Nginx en Alpine corre bajo el usuario nginx por defecto. Para que pueda leer tus carpetas de Hugo y WordPress: Bash","title":"Comprobar el estado"},{"location":"web/nginx_conf/#asegurate-de-que-el-usuario-nginx-tiene-acceso-a-tus-webs","text":"chown -R nginx:nginx /var/www/mercepons chown -R nginx:nginx /var/www/blog","title":"Aseg\u00farate de que el usuario nginx tiene acceso a tus webs"},{"location":"web/nginx_conf/#permisos-recomendados-para-directorios-y-archivos","text":"find /var/www/ -type d -exec chmod 755 {} \\; find /var/www/ -type f -exec chmod 644 {} \\; \ud83d\ude80 Paso 5: Verificaci\u00f3n y Carga Cada vez que edites tu configuraci\u00f3n (como el archivo que me pasaste antes), nunca reinicies sin probar primero: Bash","title":"Permisos recomendados para directorios y archivos"},{"location":"web/nginx_conf/#verificar-sintaxis-esto-te-ahorra-muchos-dolores-de-cabeza","text":"nginx -t","title":"Verificar sintaxis (esto te ahorra muchos dolores de cabeza)"},{"location":"web/nginx_conf/#si-el-test-es-exitoso-recarga-sin-cortar-conexiones-activas","text":"nginx -s reload","title":"Si el test es exitoso, recarga sin cortar conexiones activas"}]}