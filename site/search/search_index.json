{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\ud83c\udfe1 Bienvenido a Server Labs \u00b6 Esta documentaci\u00f3n te guiar\u00e1 paso a paso en la creaci\u00f3n de tu infraestructura con XCP-ng , Podman , WordPress , NGINX , MariaDB , . Sigue la gu\u00eda seg\u00fan tu objetivo: despliegue, seguridad, o referencia de comandos \u00fatiles. \u2699\ufe0f 1. Preparaci\u00f3n de la Infraestructura \u00b6 Servidor XCP-ng: Instalaci\u00f3n de XCP-ng Despliegue VM Debian Trixie: Gu\u00eda paso a paso Despliegue VM Alpine Linux: Gu\u00eda paso a paso \ud83d\udc33 2. Plataforma Web con Podman \u00b6 Preparaci\u00f3n de Podman: Configuraci\u00f3n del entorno Despliegue de WordPress Stack: Despliegue completo \ud83d\udd12 3. Despliegue en producci\u00f3n de sitio web con Alpine/Nginx \u00b6 Cloudflare Tunnel: Configuraci\u00f3n segura \ud83d\udee1\ufe0f 4. Monitoreo Automatizado \u00b6 \ud83d\udcda Ap\u00e9ndices \u00b6 Comandos \u00datiles: Referencia r\u00e1pida Gu\u00eda de Estilo (Oficial): Normas de documentaci\u00f3n \ud83d\udd17 Recursos Adicionales \u00b6 Repositorio GitHub del proyecto Abrir un Issue o Pull Request \ud83d\udca1 Tip: Usa la barra de b\u00fasqueda de la p\u00e1gina para encontrar cualquier comando, archivo o secci\u00f3n.","title":"\ud83c\udfe1 Inicio"},{"location":"#bienvenido-a-server-labs","text":"Esta documentaci\u00f3n te guiar\u00e1 paso a paso en la creaci\u00f3n de tu infraestructura con XCP-ng , Podman , WordPress , NGINX , MariaDB , . Sigue la gu\u00eda seg\u00fan tu objetivo: despliegue, seguridad, o referencia de comandos \u00fatiles.","title":"\ud83c\udfe1 Bienvenido a Server Labs"},{"location":"#1-preparacion-de-la-infraestructura","text":"Servidor XCP-ng: Instalaci\u00f3n de XCP-ng Despliegue VM Debian Trixie: Gu\u00eda paso a paso Despliegue VM Alpine Linux: Gu\u00eda paso a paso","title":"\u2699\ufe0f 1. Preparaci\u00f3n de la Infraestructura"},{"location":"#2-plataforma-web-con-podman","text":"Preparaci\u00f3n de Podman: Configuraci\u00f3n del entorno Despliegue de WordPress Stack: Despliegue completo","title":"\ud83d\udc33 2. Plataforma Web con Podman"},{"location":"#3-despliegue-en-produccion-de-sitio-web-con-alpinenginx","text":"Cloudflare Tunnel: Configuraci\u00f3n segura","title":"\ud83d\udd12 3. Despliegue en producci\u00f3n de sitio web con Alpine/Nginx"},{"location":"#4-monitoreo-automatizado","text":"","title":"\ud83d\udee1\ufe0f 4. Monitoreo Automatizado"},{"location":"#apendices","text":"Comandos \u00datiles: Referencia r\u00e1pida Gu\u00eda de Estilo (Oficial): Normas de documentaci\u00f3n","title":"\ud83d\udcda Ap\u00e9ndices"},{"location":"#recursos-adicionales","text":"Repositorio GitHub del proyecto Abrir un Issue o Pull Request \ud83d\udca1 Tip: Usa la barra de b\u00fasqueda de la p\u00e1gina para encontrar cualquier comando, archivo o secci\u00f3n.","title":"\ud83d\udd17 Recursos Adicionales"},{"location":"apendices/comandos_utiles/","text":"\ud83d\udee0\ufe0f Comandos \u00datiles y de Referencia Este ap\u00e9ndice contiene una lista de comandos esenciales para la gesti\u00f3n diaria y la soluci\u00f3n de problemas (troubleshooting) de los componentes clave de la infraestructura. \u2699\ufe0f Gesti\u00f3n de la M\u00e1quina Virtual (XCP-ng Console) Estos comandos se ejecutan en la consola de root del servidor XCP-ng. Verificar el estado del host: xe host-list Verificar el estado de las VMs: xe vm-list Encender una VM (usando el nombre): xe vm-start vm=[Nombre de la VM] Apagar una VM (apagado limpio): xe vm-shutdown vm=[Nombre de la VM] Verificar el estado de los Storage Repositories (SR): xe sr-list 1.2. Ejemplo de redimensionamiento de una VM Alpine Linux de 20 GiB a 40 GiB Ejecutar en el host Xen xe vm-shutdown vm=VM xe vm-disk-list vm=VM xe vdi-resize uuid=VDI_UUID disk-size=40GiB xe vm-start vm=VM Ejecutar en la VM Alpine apk add util-linux e2fsprogs growpart /dev/xvda 3 resize2fs /dev/xvda3 df -h \ud83d\udc33 Gesti\u00f3n de Contenedores (Podman) Estos comandos se ejecutan dentro de la VM Debian como tu usuario est\u00e1ndar (admin), en modo rootless. Verificar todos los contenedores (activos e inactivos): podman ps -a Verificar todas las im\u00e1genes descargadas: podman images Verificar las redes de Podman: podman network ls Detener el stack completo (en el directorio del podman-compose.yml): podman-compose down Reiniciar el stack: podman-compose restart Ver logs de un contenedor (ej: WordPress): podman logs -f wordpress_app Ejecutar un comando dentro de un contenedor (ej: en NGINX): podman exec -it nginx_proxy /bin/ Limpiar contenedores y vol\u00famenes no utilizados (\u00a1Usar con precauci\u00f3n!): podman system prune \ud83d\udee1\ufe0f Cloudflared Estos comandos se ejecutan en la VM Debian para verificar el estado de los servicios. A. Cloudflare Tunnel Verificar el estado del servicio cloudflared: sudo systemctl status cloudflared Ver logs del servicio cloudflared: sudo journalctl -u cloudflared -f \ud83d\udee0\ufe0f","title":"Comandos \u00datiles"},{"location":"preparacion/despliegue_vm_debian/","text":"Despliegue y Configuraci\u00f3n de la VM Debian Trixie Una vez que el servidor XCP-ng/XCP-ng est\u00e1 operativo, el siguiente paso es crear y configurar nuestra M\u00e1quina Virtual (VM) invitada que servir\u00e1 como host para Podman y los servicios de monitoreo. 2.1. Creaci\u00f3n de la VM en XCP-ng Utilizaremos la interfaz XCP-ng para iniciar el proceso de creaci\u00f3n de la nueva VM. Navegar al Asistente: En XCP-ng, dir\u00edgete a la secci\u00f3n de VMs y selecciona la opci\u00f3n para crear una nueva m\u00e1quina virtual. Selecci\u00f3n de Plantilla (Template): Elige una plantilla de Debian 12 (64-bit). Esto optimizar\u00e1 los par\u00e1metros iniciales de la VM. Configuraci\u00f3n de Recursos: Asigna los recursos iniciales a la VM. Ajusta estos valores seg\u00fan tus necesidades, pero se recomiendan los siguientes m\u00ednimos: Nombre: vm-podman-web (o un nombre descriptivo). CPU: 2 vCPUs RAM: 2 GB (o 4 GB si se planea una carga considerable en WordPress). Disco: 40 GB (aseg\u00farate de que el SR configurado tenga espacio suficiente). Configuraci\u00f3n de Red: Aseg\u00farate de que la VM est\u00e9 conectada a la red virtual correcta que permite el acceso desde tu red local. Instalaci\u00f3n del SO: Carga la imagen ISO de instalaci\u00f3n de Debian 12 \"Trixie\" en la biblioteca de ISOs de XCP-ng y selecci\u00f3nala para el primer arranque de la VM. Inicio de la VM: Enciende la VM y la consola se abrir\u00e1, mostrando el instalador de Debian. 2.2. Proceso de Instalaci\u00f3n de Debian 12 Sigue el proceso de instalaci\u00f3n est\u00e1ndar de Debian, prestando atenci\u00f3n a los siguientes puntos clave: Particionado: Se recomienda usar la opci\u00f3n de particionado guiado para principiantes, o crear un esquema con una partici\u00f3n /home separada para mayor flexibilidad. Configuraci\u00f3n de Red: El instalador detectar\u00e1 la red. Es crucial configurar una direcci\u00f3n IP est\u00e1tica para el servidor, ya que alojar\u00e1 servicios cr\u00edticos. IP est\u00e1tica: 192.168.1.XX (elige una que no est\u00e9 en el rango DHCP). M\u00e1scara de red, Gateway y Servidores DNS (por ejemplo, los de Cloudflare, 1.1.1.1). Usuarios: Crea una cuenta de usuario est\u00e1ndar (ej: admin). No olvides la contrase\u00f1a de root. Selecci\u00f3n de Software: Desmarca cualquier entorno de escritorio (GNOME, KDE, etc.) ya que este ser\u00e1 un servidor sin interfaz gr\u00e1fica. Aseg\u00farate de que solo est\u00e9n marcados \"servidor SSH\" y \"utilidades est\u00e1ndar del sistema\". 2.3. Configuraci\u00f3n Post-Instalaci\u00f3n Una vez que la instalaci\u00f3n haya finalizado y hayas reiniciado la VM, accede a ella a trav\u00e9s de SSH usando el usuario est\u00e1ndar que creaste: ssh admin@192.168.1.XX A. Actualizaci\u00f3n del Sistema Es fundamental mantener el sistema actualizado: sudo apt update sudo apt upgrade -y B. Instalaci\u00f3n de Herramientas Esenciales Instala herramientas que facilitar\u00e1n la gesti\u00f3n y la configuraci\u00f3n posterior: sudo apt install -y vim curl wget net-tools","title":"1.2. Despliegue VM Debian Trixie"},{"location":"preparacion/instalacion_xo_lite/","text":"\u2699\ufe0f Instalaci\u00f3n y Configuraci\u00f3n del Servidor XCP-ng \u00b6 Esta gu\u00eda detalla el proceso para establecer la plataforma de virtualizaci\u00f3n utilizando XCP-ng , la interfaz web ligera y moderna para gestionar el hypervisor XCP-ng (o XenServer). Nota: XCP-ng no es el hypervisor , sino la interfaz de gesti\u00f3n. Primero se instala XCP-ng y luego se accede a su interfaz web integrada. \ud83d\udccb 1. Prerrequisitos \u00b6 Antes de comenzar, aseg\u00farate de contar con: Un servidor f\u00edsico o m\u00e1quina virtual para instalar el hypervisor XCP-ng. Medios de instalaci\u00f3n de XCP-ng (USB o ISO). Acceso a la red local. Importante Guarda cuidadosamente la contrase\u00f1a de root que establecer\u00e1s durante la instalaci\u00f3n. Ser\u00e1 esencial para la gesti\u00f3n del servidor. \ud83d\udda5\ufe0f 2. Instalaci\u00f3n del Hypervisor XCP-ng \u00b6 La instalaci\u00f3n del hypervisor es el paso fundamental para acceder a XCP-ng. 2.1 Arranque desde el medio de instalaci\u00f3n \u00b6 Inicia el servidor usando la imagen ISO o USB de XCP-ng. El asistente te guiar\u00e1 paso a paso: Selecciona el idioma y la distribuci\u00f3n del teclado. Acepta el acuerdo de licencia (EULA) . Selecciona el disco donde se instalar\u00e1 el sistema operativo del hypervisor. Configura la contrase\u00f1a de root . Configura la red (se recomienda IP est\u00e1tica para servidores). Configura la zona horaria . Finalizaci\u00f3n: el sistema instalar\u00e1 los archivos y te pedir\u00e1 retirar el medio y reiniciar. \ud83c\udf10 3. Acceso Inicial a la Interfaz XCP-ng \u00b6 Tras reiniciar el servidor: 3.1 Obtener la Direcci\u00f3n IP \u00b6 La consola de XCP-ng mostrar\u00e1 la IP asignada (ejemplo: 192.168.1.10 ). 3.2 Acceder desde el navegador \u00b6 Abre un navegador web y navega a: https://192.168.1.10 Certificado autofirmado Es probable que tu navegador muestre una advertencia de seguridad. Acepta el certificado para continuar. 3.3 Inicio de sesi\u00f3n en XCP-ng \u00b6 Usuario: root Contrase\u00f1a: La que configuraste durante la instalaci\u00f3n de XCP-ng \u2699\ufe0f 4. Configuraci\u00f3n Post-Instalaci\u00f3n en XCP-ng \u00b6 Dentro de XCP-ng, realiza estas configuraciones b\u00e1sicas: 4.1 Configuraci\u00f3n de Red \u00b6 Verifica que la interfaz de red (NIC) tenga la IP, m\u00e1scara y gateway correctos. Configura redes virtuales o VLANs si es necesario. 4.2 Configuraci\u00f3n de Almacenamiento (Storage) \u00b6 Crea un SR (Storage Repository) para alojar las m\u00e1quinas virtuales. Ejemplos de opciones comunes: LVM Local (disco f\u00edsico dedicado) NFS o SMB (almacenamiento en red) Tip Si instalaste en un disco peque\u00f1o y tienes un disco m\u00e1s grande para VMs, crea un SR separado en ese disco para optimizar el rendimiento. 4.3 Actualizaciones \u00b6 XCP-ng facilita la aplicaci\u00f3n de parches y actualizaciones del hypervisor. Aseg\u00farate de que XCP-ng est\u00e9 actualizado antes de desplegar tus VMs. \u2705 Con la instalaci\u00f3n y configuraci\u00f3n b\u00e1sica de XCP-ng completada, tu hypervisor XCP-ng est\u00e1 listo para administrar m\u00e1quinas virtuales de forma eficiente y segura. \u27a1\ufe0f Siguiente paso recomendado: Contin\u00faa con la preparaci\u00f3n del entorno para contenedores: Preparaci\u00f3n de Podman","title":"1.1. Servidor XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#instalacion-y-configuracion-del-servidor-xcp-ng","text":"Esta gu\u00eda detalla el proceso para establecer la plataforma de virtualizaci\u00f3n utilizando XCP-ng , la interfaz web ligera y moderna para gestionar el hypervisor XCP-ng (o XenServer). Nota: XCP-ng no es el hypervisor , sino la interfaz de gesti\u00f3n. Primero se instala XCP-ng y luego se accede a su interfaz web integrada.","title":"\u2699\ufe0f Instalaci\u00f3n y Configuraci\u00f3n del Servidor XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#1-prerrequisitos","text":"Antes de comenzar, aseg\u00farate de contar con: Un servidor f\u00edsico o m\u00e1quina virtual para instalar el hypervisor XCP-ng. Medios de instalaci\u00f3n de XCP-ng (USB o ISO). Acceso a la red local. Importante Guarda cuidadosamente la contrase\u00f1a de root que establecer\u00e1s durante la instalaci\u00f3n. Ser\u00e1 esencial para la gesti\u00f3n del servidor.","title":"\ud83d\udccb 1. Prerrequisitos"},{"location":"preparacion/instalacion_xo_lite/#2-instalacion-del-hypervisor-xcp-ng","text":"La instalaci\u00f3n del hypervisor es el paso fundamental para acceder a XCP-ng.","title":"\ud83d\udda5\ufe0f 2. Instalaci\u00f3n del Hypervisor XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#21-arranque-desde-el-medio-de-instalacion","text":"Inicia el servidor usando la imagen ISO o USB de XCP-ng. El asistente te guiar\u00e1 paso a paso: Selecciona el idioma y la distribuci\u00f3n del teclado. Acepta el acuerdo de licencia (EULA) . Selecciona el disco donde se instalar\u00e1 el sistema operativo del hypervisor. Configura la contrase\u00f1a de root . Configura la red (se recomienda IP est\u00e1tica para servidores). Configura la zona horaria . Finalizaci\u00f3n: el sistema instalar\u00e1 los archivos y te pedir\u00e1 retirar el medio y reiniciar.","title":"2.1 Arranque desde el medio de instalaci\u00f3n"},{"location":"preparacion/instalacion_xo_lite/#3-acceso-inicial-a-la-interfaz-xcp-ng","text":"Tras reiniciar el servidor:","title":"\ud83c\udf10 3. Acceso Inicial a la Interfaz XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#31-obtener-la-direccion-ip","text":"La consola de XCP-ng mostrar\u00e1 la IP asignada (ejemplo: 192.168.1.10 ).","title":"3.1 Obtener la Direcci\u00f3n IP"},{"location":"preparacion/instalacion_xo_lite/#32-acceder-desde-el-navegador","text":"Abre un navegador web y navega a: https://192.168.1.10 Certificado autofirmado Es probable que tu navegador muestre una advertencia de seguridad. Acepta el certificado para continuar.","title":"3.2 Acceder desde el navegador"},{"location":"preparacion/instalacion_xo_lite/#33-inicio-de-sesion-en-xcp-ng","text":"Usuario: root Contrase\u00f1a: La que configuraste durante la instalaci\u00f3n de XCP-ng","title":"3.3 Inicio de sesi\u00f3n en XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#4-configuracion-post-instalacion-en-xcp-ng","text":"Dentro de XCP-ng, realiza estas configuraciones b\u00e1sicas:","title":"\u2699\ufe0f 4. Configuraci\u00f3n Post-Instalaci\u00f3n en XCP-ng"},{"location":"preparacion/instalacion_xo_lite/#41-configuracion-de-red","text":"Verifica que la interfaz de red (NIC) tenga la IP, m\u00e1scara y gateway correctos. Configura redes virtuales o VLANs si es necesario.","title":"4.1 Configuraci\u00f3n de Red"},{"location":"preparacion/instalacion_xo_lite/#42-configuracion-de-almacenamiento-storage","text":"Crea un SR (Storage Repository) para alojar las m\u00e1quinas virtuales. Ejemplos de opciones comunes: LVM Local (disco f\u00edsico dedicado) NFS o SMB (almacenamiento en red) Tip Si instalaste en un disco peque\u00f1o y tienes un disco m\u00e1s grande para VMs, crea un SR separado en ese disco para optimizar el rendimiento.","title":"4.2 Configuraci\u00f3n de Almacenamiento (Storage)"},{"location":"preparacion/instalacion_xo_lite/#43-actualizaciones","text":"XCP-ng facilita la aplicaci\u00f3n de parches y actualizaciones del hypervisor. Aseg\u00farate de que XCP-ng est\u00e9 actualizado antes de desplegar tus VMs. \u2705 Con la instalaci\u00f3n y configuraci\u00f3n b\u00e1sica de XCP-ng completada, tu hypervisor XCP-ng est\u00e1 listo para administrar m\u00e1quinas virtuales de forma eficiente y segura. \u27a1\ufe0f Siguiente paso recomendado: Contin\u00faa con la preparaci\u00f3n del entorno para contenedores: Preparaci\u00f3n de Podman","title":"4.3 Actualizaciones"},{"location":"seguridad/cloudflare_tunnel/","text":"5. Conexi\u00f3n Segura con Cloudflare Tunnel \u00b6 Cloudflare Tunnel (anteriormente conocido como Argo Tunnel) crea una conexi\u00f3n saliente segura entre tu VM (servidor local) y la red de Cloudflare. Esto permite que el tr\u00e1fico web llegue a tus contenedores sin exponer directamente tu IP p\u00fablica o requerir configuraciones complejas de firewall o redirecci\u00f3n de puertos (port forwarding). 5.1. Prerrequisitos en Cloudflare Dominio Activo: Tu dominio debe estar utilizando los servidores de nombres de Cloudflare. Registro DNS: Aseg\u00farate de tener un registro A o CNAME en Cloudflare para el subdominio que usar\u00e1s (ej: web.tudominio.com). El valor de la IP puede ser ficticio, ya que el Tunnel lo anular\u00e1. 5.2. Instalaci\u00f3n del Cliente cloudflared Instalaremos el cliente que gestionar\u00e1 el t\u00fanel en tu VM Debian Trixie. Descargar el Repositorio de Cloudflare: curl -fsSL https://pkg.cloudflare.com/pubkey.gpg | sudo gpg --dearmor -o /usr/share/keyrings/cloudflare.gpg echo 'deb [signed-by=/usr/share/keyrings/cloudflare.gpg] https://pkg.cloudflare.com/cloudflared trixie main' | sudo tee /etc/apt/sources.list.d/cloudflared.list Actualizar e Instalar: sudo apt update sudo apt install -y cloudflared 5.3. Creaci\u00f3n y Configuraci\u00f3n del Tunnel La configuraci\u00f3n se realiza en dos partes: autenticaci\u00f3n y definici\u00f3n del t\u00fanel (rutas). A. Autenticaci\u00f3n Autentica tu cloudflared con tu cuenta de Cloudflare. Se te pedir\u00e1 iniciar sesi\u00f3n en el navegador. cloudflared tunnel login Se abrir\u00e1 una URL en tu terminal. P\u00e9gala en tu navegador, inicia sesi\u00f3n en Cloudflare y selecciona tu dominio. B. Crear el T\u00fanel Asigna un nombre a tu t\u00fanel y crea la configuraci\u00f3n local. Crear el T\u00fanel: cloudflared tunnel create wp-tunnel (Esto te dar\u00e1 un ID de t\u00fanel \u00fanico que necesitar\u00e1s) \u00b6 Crear el Archivo de Configuraci\u00f3n (config.yml): Crea el directorio de configuraci\u00f3n para cloudflared y el archivo config.yml. sudo mkdir /etc/cloudflared sudo nano /etc/cloudflared/config.yml Pega la siguiente configuraci\u00f3n, asegur\u00e1ndote de reemplazar con el ID \u00fanico que obtuviste en el paso anterior: tunnel: <TUNNEL-ID> credentials-file: /root/.cloudflared/<TUNNEL-ID>.json ingress: # Regla 1: Tr\u00e1fico del dominio al puerto 80 del servidor local. - hostname: web.tudominio.com # Reemplaza con tu dominio service: http://localhost:80 # Regla final: Bloquea cualquier otra petici\u00f3n no mapeada. - service: http_status:404 Aqu\u00ed, http://localhost:80 se refiere al puerto del host donde est\u00e1 escuchando tu contenedor NGINX. C. Mapeo DNS y T\u00fanel Conecta el t\u00fanel a tu dominio en el panel de Cloudflare. cloudflared tunnel route dns wp-tunnel web.tudominio.com Esto crea autom\u00e1ticamente el registro DNS de tipo CNAME en tu zona de Cloudflare, apuntando a tu t\u00fanel. 5.4. Ejecuci\u00f3n del Tunnel como Servicio Ejecuta el cliente cloudflared como un servicio persistente. Instalar el Servicio del Sistema (Systemd): sudo cloudflared tunnel run --overwrite-service Iniciar y Habilitar el Servicio: sudo systemctl start cloudflared sudo systemctl enable cloudflared Verificar el Estado: sudo systemctl status cloudflared El estado debe mostrarse como active (running). Una vez que el servicio est\u00e9 activo, tu sitio web de WordPress ser\u00e1 accesible a trav\u00e9s de web.tudominio.com sin que hayas abierto un solo puerto en tu router o firewall local. Todo el tr\u00e1fico pasa a trav\u00e9s de la infraestructura segura de Cloudflare.","title":"3.2. Cloudflare Tunnel"},{"location":"seguridad/cloudflare_tunnel/#5-conexion-segura-con-cloudflare-tunnel","text":"Cloudflare Tunnel (anteriormente conocido como Argo Tunnel) crea una conexi\u00f3n saliente segura entre tu VM (servidor local) y la red de Cloudflare. Esto permite que el tr\u00e1fico web llegue a tus contenedores sin exponer directamente tu IP p\u00fablica o requerir configuraciones complejas de firewall o redirecci\u00f3n de puertos (port forwarding). 5.1. Prerrequisitos en Cloudflare Dominio Activo: Tu dominio debe estar utilizando los servidores de nombres de Cloudflare. Registro DNS: Aseg\u00farate de tener un registro A o CNAME en Cloudflare para el subdominio que usar\u00e1s (ej: web.tudominio.com). El valor de la IP puede ser ficticio, ya que el Tunnel lo anular\u00e1. 5.2. Instalaci\u00f3n del Cliente cloudflared Instalaremos el cliente que gestionar\u00e1 el t\u00fanel en tu VM Debian Trixie. Descargar el Repositorio de Cloudflare: curl -fsSL https://pkg.cloudflare.com/pubkey.gpg | sudo gpg --dearmor -o /usr/share/keyrings/cloudflare.gpg echo 'deb [signed-by=/usr/share/keyrings/cloudflare.gpg] https://pkg.cloudflare.com/cloudflared trixie main' | sudo tee /etc/apt/sources.list.d/cloudflared.list Actualizar e Instalar: sudo apt update sudo apt install -y cloudflared 5.3. Creaci\u00f3n y Configuraci\u00f3n del Tunnel La configuraci\u00f3n se realiza en dos partes: autenticaci\u00f3n y definici\u00f3n del t\u00fanel (rutas). A. Autenticaci\u00f3n Autentica tu cloudflared con tu cuenta de Cloudflare. Se te pedir\u00e1 iniciar sesi\u00f3n en el navegador. cloudflared tunnel login Se abrir\u00e1 una URL en tu terminal. P\u00e9gala en tu navegador, inicia sesi\u00f3n en Cloudflare y selecciona tu dominio. B. Crear el T\u00fanel Asigna un nombre a tu t\u00fanel y crea la configuraci\u00f3n local. Crear el T\u00fanel: cloudflared tunnel create wp-tunnel","title":"5. Conexi\u00f3n Segura con Cloudflare Tunnel"},{"location":"seguridad/cloudflare_tunnel/#esto-te-dara-un-id-de-tunel-unico-que-necesitaras","text":"Crear el Archivo de Configuraci\u00f3n (config.yml): Crea el directorio de configuraci\u00f3n para cloudflared y el archivo config.yml. sudo mkdir /etc/cloudflared sudo nano /etc/cloudflared/config.yml Pega la siguiente configuraci\u00f3n, asegur\u00e1ndote de reemplazar con el ID \u00fanico que obtuviste en el paso anterior: tunnel: <TUNNEL-ID> credentials-file: /root/.cloudflared/<TUNNEL-ID>.json ingress: # Regla 1: Tr\u00e1fico del dominio al puerto 80 del servidor local. - hostname: web.tudominio.com # Reemplaza con tu dominio service: http://localhost:80 # Regla final: Bloquea cualquier otra petici\u00f3n no mapeada. - service: http_status:404 Aqu\u00ed, http://localhost:80 se refiere al puerto del host donde est\u00e1 escuchando tu contenedor NGINX. C. Mapeo DNS y T\u00fanel Conecta el t\u00fanel a tu dominio en el panel de Cloudflare. cloudflared tunnel route dns wp-tunnel web.tudominio.com Esto crea autom\u00e1ticamente el registro DNS de tipo CNAME en tu zona de Cloudflare, apuntando a tu t\u00fanel. 5.4. Ejecuci\u00f3n del Tunnel como Servicio Ejecuta el cliente cloudflared como un servicio persistente. Instalar el Servicio del Sistema (Systemd): sudo cloudflared tunnel run --overwrite-service Iniciar y Habilitar el Servicio: sudo systemctl start cloudflared sudo systemctl enable cloudflared Verificar el Estado: sudo systemctl status cloudflared El estado debe mostrarse como active (running). Una vez que el servicio est\u00e9 activo, tu sitio web de WordPress ser\u00e1 accesible a trav\u00e9s de web.tudominio.com sin que hayas abierto un solo puerto en tu router o firewall local. Todo el tr\u00e1fico pasa a trav\u00e9s de la infraestructura segura de Cloudflare.","title":"(Esto te dar\u00e1 un ID de t\u00fanel \u00fanico que necesitar\u00e1s)"},{"location":"web/despliegue_wordpress/","text":"4. Despliegue del Sitio Web con Podman Compose \u00b6 Este documento detalla la creaci\u00f3n y ejecuci\u00f3n del stack de tres contenedores (MariaDB, WordPress y NGINX) utilizando podman-compose para pruebas antes del despliege en producci\u00f3n. Este m\u00e9todo asegura que los servicios se orquesten correctamente, se comuniquen a trav\u00e9s de una red interna y persistan sus datos. 4.1. Estructura de Directorios Trabajaremos dentro del directorio de nuestro usuario (admin en este ejemplo). cd ~ mkdir -p projects/wordpress-stack cd projects/wordpress-stack Dentro de este directorio, crearemos nuestro archivo de orquestaci\u00f3n y una carpeta para los archivos de configuraci\u00f3n de NGINX. 4.2. Creaci\u00f3n del Archivo de Configuraci\u00f3n de NGINX Aunque NGINX actuar\u00e1 como proxy inverso, necesita un archivo de configuraci\u00f3n simple para redirigir el tr\u00e1fico al contenedor de WordPress. Crear el directorio de configuraci\u00f3n: mkdir -p nginx/conf.d Crear el archivo default.conf (nginx/conf.d/default.conf): Nginx server { listen 80; location / { # El nombre del servidor debe coincidir con el nombre del servicio de WordPress en podman-compose proxy_pass http://wordpress:80; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } Este archivo le dice a NGINX que escuche en el puerto 80 y pase todas las peticiones al servicio interno http://wordpress:80. 4.3. El Archivo podman-compose.yml Este archivo define los tres servicios, sus dependencias, variables de entorno y los vol\u00famenes persistentes. Crea el archivo podman-compose.yml en la ra\u00edz de ~/projects/wordpress-stack/. version: '3.8' services: # 1. Base de Datos (MariaDB) db: image: mariadb:10.11 container_name: mariadb_wp restart: always environment: # *** MODIFICAR ESTOS VALORES *** MARIADB_ROOT_PASSWORD: <tu_password_root_db> MARIADB_DATABASE: wordpress MARIADB_USER: wpuser MARIADB_PASSWORD: <tu_password_usuario_db> volumes: - ~/data/mariadb:/var/lib/mysql # Persistencia de datos networks: - web_net # 2. Aplicaci\u00f3n (WordPress) wordpress: image: wordpress:latest container_name: wordpress_app restart: always depends_on: - db # Asegura que la DB se inicie antes que WordPress environment: # Utiliza los mismos valores que en el servicio 'db' WORDPRESS_DB_HOST: db:3306 # El nombre del servicio DB WORDPRESS_DB_NAME: wordpress WORDPRESS_DB_USER: wpuser WORDPRESS_DB_PASSWORD: <tu_password_usuario_db> volumes: - ~/data/wordpress:/var/www/html # Persistencia de c\u00f3digo y uploads networks: - web_net # 3. Proxy (NGINX) nginx: image: nginx:stable container_name: nginx_proxy restart: always depends_on: - wordpress ports: - \"80:80\" # Puerto HTTP - \"443:443\" # Puerto HTTPS volumes: - ./nginx/conf.d:/etc/nginx/conf.d:ro # Monta el archivo de configuraci\u00f3n creado networks: - web_net networks: # Referencia a la red creada en el paso anterior (preparacion_podman.md) web_net: external: true 4.4. Despliegue de los Servicios Una vez que el archivo podman-compose.yml est\u00e9 listo, despliega el stack en modo detached (segundo plano): podman-compose up -d 4.5. Verificaci\u00f3n Verificar el estado de los contenedores: podman ps Deber\u00edas ver los tres contenedores (mariadb_wp, wordpress_app, nginx_proxy) con el estado Up. Verificar el log de WordPress (opcional): podman logs -f wordpress_app Esto confirmar\u00e1 que WordPress se ha conectado correctamente a la base de datos MariaDB. Acceso Local: Si la red local lo permite, intenta acceder al sitio desde tu m\u00e1quina local usando la IP de la VM: http://192.168.1.XX. Deber\u00edas ver la pantalla de configuraci\u00f3n inicial de WordPress. Script para solucinonar poibles problemas con los permisos de Wordpress a la hora de subir archivos como im\u00e1genes al servidor #!/bin/bash # Script para preparar directorios y permisos rootless de WordPress en Podman set -e # Variables VOLUME_PATH=\"$HOME/.local/share/containers/storage/volumes/www_wp_data/_data\" WP_CONTENT=\"$VOLUME_PATH/wp-content\" echo \"\u2705 Creando directorios necesarios...\" podman unshare mkdir -p \"$WP_CONTENT/uploads\" podman unshare mkdir -p \"$WP_CONTENT/plugins\" podman unshare mkdir -p \"$WP_CONTENT/cache\" echo \"\u2705 Ajustando propietario a www-data (UID 33:GID 33)...\" podman unshare chown -R 33:33 \"$WP_CONTENT\" echo \"\u2705 Ajustando permisos a 775...\" podman unshare chmod -R 775 \"$WP_CONTENT\" echo \"\u2705 Todo listo. WordPress puede escribir en wp-content.\"","title":"2.2. Despliegue de WordPress Stack"},{"location":"web/despliegue_wordpress/#4-despliegue-del-sitio-web-con-podman-compose","text":"Este documento detalla la creaci\u00f3n y ejecuci\u00f3n del stack de tres contenedores (MariaDB, WordPress y NGINX) utilizando podman-compose para pruebas antes del despliege en producci\u00f3n. Este m\u00e9todo asegura que los servicios se orquesten correctamente, se comuniquen a trav\u00e9s de una red interna y persistan sus datos. 4.1. Estructura de Directorios Trabajaremos dentro del directorio de nuestro usuario (admin en este ejemplo). cd ~ mkdir -p projects/wordpress-stack cd projects/wordpress-stack Dentro de este directorio, crearemos nuestro archivo de orquestaci\u00f3n y una carpeta para los archivos de configuraci\u00f3n de NGINX. 4.2. Creaci\u00f3n del Archivo de Configuraci\u00f3n de NGINX Aunque NGINX actuar\u00e1 como proxy inverso, necesita un archivo de configuraci\u00f3n simple para redirigir el tr\u00e1fico al contenedor de WordPress. Crear el directorio de configuraci\u00f3n: mkdir -p nginx/conf.d Crear el archivo default.conf (nginx/conf.d/default.conf): Nginx server { listen 80; location / { # El nombre del servidor debe coincidir con el nombre del servicio de WordPress en podman-compose proxy_pass http://wordpress:80; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } Este archivo le dice a NGINX que escuche en el puerto 80 y pase todas las peticiones al servicio interno http://wordpress:80. 4.3. El Archivo podman-compose.yml Este archivo define los tres servicios, sus dependencias, variables de entorno y los vol\u00famenes persistentes. Crea el archivo podman-compose.yml en la ra\u00edz de ~/projects/wordpress-stack/. version: '3.8' services: # 1. Base de Datos (MariaDB) db: image: mariadb:10.11 container_name: mariadb_wp restart: always environment: # *** MODIFICAR ESTOS VALORES *** MARIADB_ROOT_PASSWORD: <tu_password_root_db> MARIADB_DATABASE: wordpress MARIADB_USER: wpuser MARIADB_PASSWORD: <tu_password_usuario_db> volumes: - ~/data/mariadb:/var/lib/mysql # Persistencia de datos networks: - web_net # 2. Aplicaci\u00f3n (WordPress) wordpress: image: wordpress:latest container_name: wordpress_app restart: always depends_on: - db # Asegura que la DB se inicie antes que WordPress environment: # Utiliza los mismos valores que en el servicio 'db' WORDPRESS_DB_HOST: db:3306 # El nombre del servicio DB WORDPRESS_DB_NAME: wordpress WORDPRESS_DB_USER: wpuser WORDPRESS_DB_PASSWORD: <tu_password_usuario_db> volumes: - ~/data/wordpress:/var/www/html # Persistencia de c\u00f3digo y uploads networks: - web_net # 3. Proxy (NGINX) nginx: image: nginx:stable container_name: nginx_proxy restart: always depends_on: - wordpress ports: - \"80:80\" # Puerto HTTP - \"443:443\" # Puerto HTTPS volumes: - ./nginx/conf.d:/etc/nginx/conf.d:ro # Monta el archivo de configuraci\u00f3n creado networks: - web_net networks: # Referencia a la red creada en el paso anterior (preparacion_podman.md) web_net: external: true 4.4. Despliegue de los Servicios Una vez que el archivo podman-compose.yml est\u00e9 listo, despliega el stack en modo detached (segundo plano): podman-compose up -d 4.5. Verificaci\u00f3n Verificar el estado de los contenedores: podman ps Deber\u00edas ver los tres contenedores (mariadb_wp, wordpress_app, nginx_proxy) con el estado Up. Verificar el log de WordPress (opcional): podman logs -f wordpress_app Esto confirmar\u00e1 que WordPress se ha conectado correctamente a la base de datos MariaDB. Acceso Local: Si la red local lo permite, intenta acceder al sitio desde tu m\u00e1quina local usando la IP de la VM: http://192.168.1.XX. Deber\u00edas ver la pantalla de configuraci\u00f3n inicial de WordPress. Script para solucinonar poibles problemas con los permisos de Wordpress a la hora de subir archivos como im\u00e1genes al servidor #!/bin/bash # Script para preparar directorios y permisos rootless de WordPress en Podman set -e # Variables VOLUME_PATH=\"$HOME/.local/share/containers/storage/volumes/www_wp_data/_data\" WP_CONTENT=\"$VOLUME_PATH/wp-content\" echo \"\u2705 Creando directorios necesarios...\" podman unshare mkdir -p \"$WP_CONTENT/uploads\" podman unshare mkdir -p \"$WP_CONTENT/plugins\" podman unshare mkdir -p \"$WP_CONTENT/cache\" echo \"\u2705 Ajustando propietario a www-data (UID 33:GID 33)...\" podman unshare chown -R 33:33 \"$WP_CONTENT\" echo \"\u2705 Ajustando permisos a 775...\" podman unshare chmod -R 775 \"$WP_CONTENT\" echo \"\u2705 Todo listo. WordPress puede escribir en wp-content.\"","title":"4. Despliegue del Sitio Web con Podman Compose"},{"location":"web/preparacion_podman/","text":"3. Preparaci\u00f3n del Entorno para Contenedores con Podman \u00b6 Podman es una herramienta de gesti\u00f3n de contenedores daemonless (sin demonio), lo que lo convierte en una opci\u00f3n m\u00e1s ligera y segura que Docker, especialmente para entornos rootless (sin privilegios de root). 3.1. Instalaci\u00f3n de Podman y Podman-Compose Podman est\u00e1 disponible en los repositorios de Debian Trixie (12). sudo apt install -y podman Podman-compose (para orquestaci\u00f3n multi-contenedor, similar a docker-compose) \u00b6 sudo apt install -y podman-compose Verificar la Instalaci\u00f3n: podman --version podman-compose --version 3.2. Configuraci\u00f3n de Entornos Rootless (Sin Root) Por seguridad, es una buena pr\u00e1ctica ejecutar contenedores con un usuario normal en lugar de root. Esto se conoce como modo Rootless. Verificar la configuraci\u00f3n de subordinate IDs: El sistema Debian ya debe haber configurado los archivos /etc/subuid y /etc/subgid para permitir al usuario est\u00e1ndar tener rangos de IDs para contenedores. Confirma que tu usuario (admin o el que hayas creado) aparece en estos archivos. Inicializaci\u00f3n del Entorno Rootless: La primera vez que ejecutas un comando Podman como tu usuario normal, el sistema inicializa autom\u00e1ticamente el entorno: Ejecuta un comando simple para forzar la inicializaci\u00f3n \u00b6 podman info Configuraci\u00f3n del Registro de Contenedores: Si planeas utilizar registros no oficiales, edita el archivo de registros: Opcional: Para permitir im\u00e1genes no firmadas o de otros registros \u00b6 sudo vim /etc/containers/registries.conf 3.3. Estructura de Redes y Vol\u00famenes de Podman Para la comunicaci\u00f3n entre los contenedores de WordPress, NGINX y MariaDB, y para asegurar la persistencia de los datos, configuraremos una red y vol\u00famenes dedicados. A. Crear una Red Dedicada La red interna permitir\u00e1 que los contenedores se comuniquen usando sus nombres de servicio. Crea una nueva red Podman llamada 'web_net' \u00b6 podman network create web_net B. Conceptos de Vol\u00famenes Persistentes En el archivo podman-compose.yml (que veremos a continuaci\u00f3n), mapearemos directorios locales a directorios dentro de los contenedores (volumes:). WordPress Data: Mapearemos una carpeta local (ej: /home/admin/data/wordpress) al directorio /var/www/html del contenedor de WordPress. Database Data: Mapearemos otra carpeta (ej: /home/admin/data/mariadb) al directorio de datos de MariaDB. Crear la estructura de carpetas de datos: mkdir -p ~/data/wordpress mkdir -p ~/data/mariadb Con Podman y su entorno rootless instalados, la red interna configurada y las carpetas de datos creadas, estamos listos para pasar al despliegue del stack de WordPress. \ud83d\udc33 Caracter\u00edsticas Clave de Podman \u00b6 Podman destaca por su enfoque en la seguridad y la arquitectura descentralizada. Arquitectura Sin Demonio (Daemonless) \u00b6 Seguridad: A diferencia de Docker, Podman no utiliza un demonio central (daemon) que se ejecuta como root. En su lugar, utiliza un modelo de arquitectura fork-exec, donde el comando podman inicia directamente el proceso del contenedor, que a su vez utiliza runc (el tiempo de ejecuci\u00f3n OCI).Ventaja: Esto elimina el riesgo de que un atacante que comprometa el daemon obtenga privilegios de root en el sistema operativo host. Contenedores Sin Privilegios (Rootless Containers) \u00b6 Seguridad: La caracter\u00edstica m\u00e1s destacada de Podman es su capacidad para ejecutar contenedores como un usuario normal, sin requerir privilegios de root.Funcionamiento: Esto se logra utilizando los namespaces de usuario de Linux, mapeando el UID de root dentro del contenedor a un UID sin privilegios en el sistema host. Si el contenedor es comprometido, el atacante solo tiene los bajos privilegios del usuario host. Soporte para Pods \u00b6 Orquestaci\u00f3n Local: Podman es compatible con la idea de Pods, una caracter\u00edstica central de Kubernetes. Un Pod es un grupo de uno o m\u00e1s contenedores que comparten recursos como el namespace de red, el almacenamiento local y el IPC.Kubernetes: Podman puede generar archivos YAML de Kubernetes directamente a partir de contenedores o Pods en ejecuci\u00f3n, simplificando la transici\u00f3n del desarrollo local a la orquestaci\u00f3n en cl\u00fasteres.4. Compatibilidad con DockerInterfaz CLI: Podman utiliza comandos id\u00e9nticos o casi id\u00e9nticos a los de Docker (por ejemplo, podman run, podman ps, podman images), lo que permite a los usuarios con experiencia en Docker cambiar a Podman r\u00e1pidamente.Im\u00e1genes: Podman puede usar y construir im\u00e1genes de contenedor compatibles con Docker y OCI.","title":"2.1. Preparaci\u00f3n de Podman"},{"location":"web/preparacion_podman/#3-preparacion-del-entorno-para-contenedores-con-podman","text":"Podman es una herramienta de gesti\u00f3n de contenedores daemonless (sin demonio), lo que lo convierte en una opci\u00f3n m\u00e1s ligera y segura que Docker, especialmente para entornos rootless (sin privilegios de root). 3.1. Instalaci\u00f3n de Podman y Podman-Compose Podman est\u00e1 disponible en los repositorios de Debian Trixie (12). sudo apt install -y podman","title":"3. Preparaci\u00f3n del Entorno para Contenedores con Podman"},{"location":"web/preparacion_podman/#podman-compose-para-orquestacion-multi-contenedor-similar-a-docker-compose","text":"sudo apt install -y podman-compose Verificar la Instalaci\u00f3n: podman --version podman-compose --version 3.2. Configuraci\u00f3n de Entornos Rootless (Sin Root) Por seguridad, es una buena pr\u00e1ctica ejecutar contenedores con un usuario normal en lugar de root. Esto se conoce como modo Rootless. Verificar la configuraci\u00f3n de subordinate IDs: El sistema Debian ya debe haber configurado los archivos /etc/subuid y /etc/subgid para permitir al usuario est\u00e1ndar tener rangos de IDs para contenedores. Confirma que tu usuario (admin o el que hayas creado) aparece en estos archivos. Inicializaci\u00f3n del Entorno Rootless: La primera vez que ejecutas un comando Podman como tu usuario normal, el sistema inicializa autom\u00e1ticamente el entorno:","title":"Podman-compose (para orquestaci\u00f3n multi-contenedor, similar a docker-compose)"},{"location":"web/preparacion_podman/#ejecuta-un-comando-simple-para-forzar-la-inicializacion","text":"podman info Configuraci\u00f3n del Registro de Contenedores: Si planeas utilizar registros no oficiales, edita el archivo de registros:","title":"Ejecuta un comando simple para forzar la inicializaci\u00f3n"},{"location":"web/preparacion_podman/#opcional-para-permitir-imagenes-no-firmadas-o-de-otros-registros","text":"sudo vim /etc/containers/registries.conf 3.3. Estructura de Redes y Vol\u00famenes de Podman Para la comunicaci\u00f3n entre los contenedores de WordPress, NGINX y MariaDB, y para asegurar la persistencia de los datos, configuraremos una red y vol\u00famenes dedicados. A. Crear una Red Dedicada La red interna permitir\u00e1 que los contenedores se comuniquen usando sus nombres de servicio.","title":"Opcional: Para permitir im\u00e1genes no firmadas o de otros registros"},{"location":"web/preparacion_podman/#crea-una-nueva-red-podman-llamada-web_net","text":"podman network create web_net B. Conceptos de Vol\u00famenes Persistentes En el archivo podman-compose.yml (que veremos a continuaci\u00f3n), mapearemos directorios locales a directorios dentro de los contenedores (volumes:). WordPress Data: Mapearemos una carpeta local (ej: /home/admin/data/wordpress) al directorio /var/www/html del contenedor de WordPress. Database Data: Mapearemos otra carpeta (ej: /home/admin/data/mariadb) al directorio de datos de MariaDB. Crear la estructura de carpetas de datos: mkdir -p ~/data/wordpress mkdir -p ~/data/mariadb Con Podman y su entorno rootless instalados, la red interna configurada y las carpetas de datos creadas, estamos listos para pasar al despliegue del stack de WordPress.","title":"Crea una nueva red Podman llamada 'web_net'"},{"location":"web/preparacion_podman/#caracteristicas-clave-de-podman","text":"Podman destaca por su enfoque en la seguridad y la arquitectura descentralizada.","title":"\ud83d\udc33 Caracter\u00edsticas Clave de Podman"},{"location":"web/preparacion_podman/#arquitectura-sin-demonio-daemonless","text":"Seguridad: A diferencia de Docker, Podman no utiliza un demonio central (daemon) que se ejecuta como root. En su lugar, utiliza un modelo de arquitectura fork-exec, donde el comando podman inicia directamente el proceso del contenedor, que a su vez utiliza runc (el tiempo de ejecuci\u00f3n OCI).Ventaja: Esto elimina el riesgo de que un atacante que comprometa el daemon obtenga privilegios de root en el sistema operativo host.","title":"Arquitectura Sin Demonio (Daemonless)"},{"location":"web/preparacion_podman/#contenedores-sin-privilegios-rootless-containers","text":"Seguridad: La caracter\u00edstica m\u00e1s destacada de Podman es su capacidad para ejecutar contenedores como un usuario normal, sin requerir privilegios de root.Funcionamiento: Esto se logra utilizando los namespaces de usuario de Linux, mapeando el UID de root dentro del contenedor a un UID sin privilegios en el sistema host. Si el contenedor es comprometido, el atacante solo tiene los bajos privilegios del usuario host.","title":"Contenedores Sin Privilegios (Rootless Containers)"},{"location":"web/preparacion_podman/#soporte-para-pods","text":"Orquestaci\u00f3n Local: Podman es compatible con la idea de Pods, una caracter\u00edstica central de Kubernetes. Un Pod es un grupo de uno o m\u00e1s contenedores que comparten recursos como el namespace de red, el almacenamiento local y el IPC.Kubernetes: Podman puede generar archivos YAML de Kubernetes directamente a partir de contenedores o Pods en ejecuci\u00f3n, simplificando la transici\u00f3n del desarrollo local a la orquestaci\u00f3n en cl\u00fasteres.4. Compatibilidad con DockerInterfaz CLI: Podman utiliza comandos id\u00e9nticos o casi id\u00e9nticos a los de Docker (por ejemplo, podman run, podman ps, podman images), lo que permite a los usuarios con experiencia en Docker cambiar a Podman r\u00e1pidamente.Im\u00e1genes: Podman puede usar y construir im\u00e1genes de contenedor compatibles con Docker y OCI.","title":"Soporte para Pods"}]}