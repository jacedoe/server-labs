{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83c\udfe1 Bienvenido a Server Labs","text":"<p>Esta documentaci\u00f3n te guiar\u00e1 paso a paso en la creaci\u00f3n de tu infraestructura con XCP-ng, Linux y FreeBSD. </p> <p>Sigue la gu\u00eda seg\u00fan tu objetivo: despliegue de VM, contenedores o referencia de comandos \u00fatiles.</p>"},{"location":"#1-preparacion-de-la-infraestructura","title":"\u2699\ufe0f 1. Preparaci\u00f3n de la Infraestructura","text":"<ul> <li>Servidor XCP-ng: Instalaci\u00f3n de XCP-ng </li> <li>Despliegue VM Alpine Linux: Gu\u00eda paso a paso</li> </ul>"},{"location":"#2-despliegue-en-produccion-de-sitio-web","title":"\ud83d\udd12 2. Despliegue en producci\u00f3n de sitio web","text":"<ul> <li>Instalaci\u00f3n y configuraci\u00f3n de Nginx y Hugo Despliegue completo</li> <li>Configuraci\u00f3n del stack Alpine-Nginx-MariaDB-WordPress Despliegue completo</li> <li>Cloudflare Tunnel: Configuraci\u00f3n segura</li> </ul>"},{"location":"#3-guia-de-despliegue-en-freebsd","title":"\ud83d\ude08 3. Gu\u00eda de Despliegue en FreeBSD","text":"<ul> <li>Wordpress y Hugo en FreeBSD con Jails Despliegue completo</li> </ul>"},{"location":"#apendices","title":"\ud83d\udcda Ap\u00e9ndices","text":"<ul> <li>Comandos \u00datiles: Referencia r\u00e1pida </li> </ul>"},{"location":"#recursos-adicionales","title":"\ud83d\udd17 Recursos Adicionales","text":"<ul> <li>Repositorio GitHub del proyecto </li> </ul> <p>\ud83d\udca1 Tip: Usa la barra de b\u00fasqueda de la p\u00e1gina para encontrar cualquier comando, archivo o secci\u00f3n.</p>"},{"location":"apendices/comandos_utiles/","title":"Comandos \u00datiles","text":"<p>\ud83d\udee0\ufe0f Comandos \u00datiles y de Referencia Este ap\u00e9ndice contiene una lista de comandos esenciales para la gesti\u00f3n diaria y la soluci\u00f3n de problemas (troubleshooting) de los componentes clave de la infraestructura.</p> <ol> <li>\u2699\ufe0f Gesti\u00f3n de la M\u00e1quina Virtual (XCP-ng Console) Estos comandos se ejecutan en la consola de root del servidor XCP-ng.</li> </ol> <p>Verificar el estado del host: <pre><code>xe host-list\n</code></pre> Verificar el estado de las VMs: <pre><code>xe vm-list\n</code></pre> Encender una VM (usando el nombre): <pre><code>xe vm-start vm=[Nombre de la VM]\n</code></pre> Apagar una VM (apagado limpio): <pre><code>xe vm-shutdown vm=[Nombre de la VM]\n</code></pre> Verificar el estado de los Storage Repositories (SR): <pre><code>xe sr-list\n</code></pre></p> <p>1.2. Ejemplo de redimensionamiento de una VM Alpine Linux de 20 GiB a 40 GiB</p> <p>Ejecutar en el host Xen <pre><code>xe vm-shutdown vm=VM\nxe vm-disk-list vm=VM\nxe vdi-resize uuid=VDI_UUID disk-size=40GiB\nxe vm-start vm=VM\n</code></pre> Ejecutar en la VM Alpine <pre><code>apk add util-linux e2fsprogs\ngrowpart /dev/xvda 3\nresize2fs /dev/xvda3\ndf -h\n</code></pre></p> <p>```</p> <p>\ud83d\udee0\ufe0f </p>"},{"location":"apendices/notas/","title":"Notas","text":"<p>\ud83d\udc33 Gesti\u00f3n de Contenedores (Podman)</p> <p>Estos comandos se ejecutan dentro de la VM Debian como tu usuario est\u00e1ndar (admin), en modo rootless.</p> <p>Verificar todos los contenedores (activos e inactivos): <pre><code>podman ps -a\n</code></pre> Verificar todas las im\u00e1genes descargadas: <pre><code>podman images\n</code></pre> Verificar las redes de Podman: <pre><code>podman network ls\n</code></pre> Detener el stack completo (en el directorio del podman-compose.yml): <pre><code>podman-compose down\n</code></pre> Reiniciar el stack: <pre><code>podman-compose restart\n</code></pre> Ver logs de un contenedor (ej: WordPress): <pre><code>podman logs -f wordpress_app\n</code></pre> Ejecutar un comando dentro de un contenedor (ej:   en NGINX): <pre><code>podman exec -it nginx_proxy /bin/ \n</code></pre> Limpiar contenedores y vol\u00famenes no utilizados (\u00a1Usar con precauci\u00f3n!): <pre><code>podman system prune\n</code></pre> \ud83d\udee1\ufe0f Cloudflared</p> <p>Estos comandos se ejecutan en la VM Debian para verificar el estado de los servicios.</p> <p>A. Cloudflare Tunnel Verificar el estado del servicio cloudflared: <pre><code>sudo systemctl status cloudflared\n</code></pre> Ver logs del servicio cloudflared: ``` sudo journalctl -u cloudflared -f</p>"},{"location":"freebsd/deploy_www_jails/","title":"Gu\u00eda de Despliegue: WordPress y Hugo en FreeBSD con Jails","text":""},{"location":"freebsd/deploy_www_jails/#introduccion","title":"Introducci\u00f3n","text":"<p>Esta gu\u00eda describe los pasos necesarios para desplegar un sitio web con Hugo y otro con WordPress en un entorno de FreeBSD utilizando jails, Nginx, PHP-FPM, y MariaDB.</p>"},{"location":"freebsd/deploy_www_jails/#requisitos-previos","title":"Requisitos Previos","text":"<ul> <li>Un sistema FreeBSD configurado.</li> <li>Acceso a <code>root</code> o un usuario con privilegios de administrador.</li> <li>Conocimientos b\u00e1sicos de la terminal y configuraci\u00f3n de servicios en FreeBSD.</li> </ul>"},{"location":"freebsd/deploy_www_jails/#1-configuracion-del-entorno","title":"1. Configuraci\u00f3n del Entorno","text":""},{"location":"freebsd/deploy_www_jails/#11-crear-el-jail","title":"1.1 Crear el Jail","text":"<p><code># Crear el jail iocage create -n \"mi_jail\" -r 13.2-RELEASE ip4_addr=\"em0|10.8.8.2/24\"   # Iniciar el jail iocage start mi_jail   # Acceder al jail iocage console mi_jail</code></p>"},{"location":"freebsd/deploy_www_jails/#12-instalar-paquetes-necesarios","title":"1.2 Instalar Paquetes Necesarios","text":"<p><code># Actualizar los paquetes pkg update &amp;&amp; pkg upgrade   # Instalar Nginx, PHP-FPM, MariaDB, y Hugo pkg install nginx php82 php82-fpm mariadb106-server mariadb106-client hugo</code></p>"},{"location":"freebsd/deploy_www_jails/#2-configuracion-de-nginx","title":"2. Configuraci\u00f3n de Nginx","text":""},{"location":"freebsd/deploy_www_jails/#21-configuracion-para-hugo","title":"2.1 Configuraci\u00f3n para Hugo","text":"<p>Crea el archivo <code>/etc/nginx/http.d/merceponsautora.com.conf</code> con el siguiente contenido:</p> <p><code>server {  listen  10.8.8.2:8080; server_name merceponsautora.com www.merceponsautora.com;   root /usr/local/www/merceponsautora.com/public; index index.html;   location / { try_files $uri $uri/ =404; } }</code></p>"},{"location":"freebsd/deploy_www_jails/#22-configuracion-para-wordpress","title":"2.2 Configuraci\u00f3n para WordPress","text":"<p>Crea el archivo <code>/etc/nginx/http.d/blog.merceponsautora.com.conf</code> con el siguiente contenido:</p> <p><code>server {  listen  10.8.8.2:80; server_name blog.merceponsautora.com;   root /usr/local/www/blog; index index.php index.html index.htm;   location / { try_files $uri $uri/ /index.php?$args; }   location  ~ \\.php$ { include fastcgi.conf; fastcgi_pass  127.0.0.1:9000; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; }   location  ~ /\\.ht { deny all; } }</code></p>"},{"location":"freebsd/deploy_www_jails/#23-habilitar-y-reiniciar-nginx","title":"2.3 Habilitar y Reiniciar Nginx","text":"<p><code>sysrc nginx_enable=yes service nginx start</code></p>"},{"location":"freebsd/deploy_www_jails/#3-configuracion-de-php-fpm","title":"3. Configuraci\u00f3n de PHP-FPM","text":""},{"location":"freebsd/deploy_www_jails/#31-configurar-php-fpm-para-tcp","title":"3.1 Configurar PHP-FPM para TCP","text":"<p>Edita el archivo <code>/usr/local/etc/php-fpm.d/www.conf</code>:</p> <p><code>listen = 127.0.0.1:9000 listen.owner = www listen.group = www listen.mode = 0660</code></p>"},{"location":"freebsd/deploy_www_jails/#32-habilitar-y-reiniciar-php-fpm","title":"3.2 Habilitar y Reiniciar PHP-FPM","text":"<p><code>sysrc php_fpm_enable=yes service php_fpm start</code></p>"},{"location":"freebsd/deploy_www_jails/#4-configuracion-de-mariadb","title":"4. Configuraci\u00f3n de MariaDB","text":""},{"location":"freebsd/deploy_www_jails/#41-habilitar-y-iniciar-mariadb","title":"4.1 Habilitar y Iniciar MariaDB","text":"<p><code>sysrc mysql_enable=yes service mysql-server start</code></p>"},{"location":"freebsd/deploy_www_jails/#42-configurar-la-base-de-datos-para-wordpress","title":"4.2 Configurar la Base de Datos para WordPress","text":"<p><code>mysql -u root -p</code></p> <p>Dentro de MariaDB:</p> <p><code>CREATE DATABASE wordpress; GRANT  ALL PRIVILEGES ON wordpress.*  TO  'wordpress'@'localhost' IDENTIFIED BY  'mypasswd'; FLUSH PRIVILEGES; EXIT;</code></p>"},{"location":"freebsd/deploy_www_jails/#5-configuracion-de-wordpress","title":"5. Configuraci\u00f3n de WordPress","text":""},{"location":"freebsd/deploy_www_jails/#51-descargar-y-configurar-wordpress","title":"5.1 Descargar y Configurar WordPress","text":"<p><code>mkdir -p /usr/local/www/blog cd /usr/local/www/blog fetch https://wordpress.org/latest.tar.gz tar -xzvf latest.tar.gz mv wordpress/* . rm -rf wordpress latest.tar.gz chown -R www:www /usr/local/www/blog</code></p>"},{"location":"freebsd/deploy_www_jails/#52-configurar-wp-configphp","title":"5.2 Configurar <code>wp-config.php</code>","text":"<p>Edita el archivo <code>wp-config.php</code>:</p> <p><code>define('DB_NAME', 'wordpress'); define('DB_USER', 'wordpress'); define('DB_PASSWORD', 'mypasswd'); define('DB_HOST', '127.0.0.1'); define('DB_CHARSET', 'utf8mb4'); define('DB_COLLATE', '');   $table_prefix = 'wp_';   define('WP_HOME', 'http://192.168.1.57'); define('WP_SITEURL', 'http://192.168.1.57');   define('WP_DEBUG', true); define('WP_DEBUG_LOG', true); define('WP_DEBUG_DISPLAY', false);   require_once  __DIR__ . '/wp-settings.php';</code></p>"},{"location":"freebsd/deploy_www_jails/#6-configuracion-de-hugo","title":"6. Configuraci\u00f3n de Hugo","text":""},{"location":"freebsd/deploy_www_jails/#61-crear-el-sitio-con-hugo","title":"6.1 Crear el Sitio con Hugo","text":"<p><code>mkdir -p /usr/local/www/merceponsautora.com cd /usr/local/www/merceponsautora.com hugo new site .</code></p>"},{"location":"freebsd/deploy_www_jails/#62-generar-el-sitio-estatico","title":"6.2 Generar el Sitio Est\u00e1tico","text":"<p><code>hugo</code></p>"},{"location":"freebsd/deploy_www_jails/#7-configuracion-de-pf-packet-filter","title":"7. Configuraci\u00f3n de PF (Packet Filter)","text":""},{"location":"freebsd/deploy_www_jails/#71-configurar-pf-en-el-host-principal","title":"7.1 Configurar PF en el Host Principal","text":"<p>Edita el archivo <code>/etc/pf.conf</code> en el host principal:</p> <p><code>ext_if = \"xn0\" jail_net = \"10.8.8.0/24\"   nat on $ext_if from $jail_net to any -&gt; ($ext_if)   rdr pass on $ext_if inet proto tcp from any to 192.168.1.57 port 8080 -&gt; 10.8.8.2 port 8080 rdr pass on $ext_if inet proto tcp from any to 192.168.1.57 port 80 -&gt; 10.8.8.2 port 80</code></p>"},{"location":"freebsd/deploy_www_jails/#72-habilitar-y-recargar-pf","title":"7.2 Habilitar y Recargar PF","text":"<p><code>sysrc pf_enable=yes service pf start pfctl -f /etc/pf.conf</code></p>"},{"location":"freebsd/deploy_www_jails/#8-probar-el-acceso","title":"8. Probar el Acceso","text":""},{"location":"freebsd/deploy_www_jails/#81-desde-el-jail","title":"8.1 Desde el Jail","text":"<p><code>curl http://10.8.8.2:8080 # Para Hugo curl http://10.8.8.2 # Para WordPress</code></p>"},{"location":"freebsd/deploy_www_jails/#82-desde-otro-host-en-la-lan","title":"8.2 Desde Otro Host en la LAN","text":"<p><code>curl http://192.168.1.57:8080 # Para Hugo curl http://192.168.1.57 # Para WordPress</code></p>"},{"location":"preparacion/instalacion_alpine/","title":"1. Despliegue VM Alpine Linux","text":"<p>Este apartado describe el proceso completo para desplegar una m\u00e1quina virtual con Alpine Linux sobre un servidor XCP-ng, as\u00ed como su configuraci\u00f3n inicial para dejarla lista para administraci\u00f3n remota y uso de contenedores con Docker.</p>"},{"location":"preparacion/instalacion_alpine/#2-requisitos-previos","title":"2. Requisitos previos","text":"<p>Antes de comenzar, aseg\u00farate de contar con:</p> <p>Servidor XCP-ng correctamente instalado y operativo</p> <p>Acceso a Xen Orchestra (XO Lite o completo)</p> <p>Imagen ISO de Alpine Linux (Standard x86_64)</p> <p>Conectividad de red funcional</p> <p>Conocimientos b\u00e1sicos de consola Linux</p>"},{"location":"preparacion/instalacion_alpine/#3-creacion-de-la-maquina-virtual-en-xcp-ng","title":"3. Creaci\u00f3n de la m\u00e1quina virtual en XCP-ng","text":"<p>Accede a Xen Orchestra</p> <p>Selecciona New VM</p> <p>Elige la plantilla:</p> <p>Other install media</p> <p>Asigna los recursos recomendados:</p> <p>CPU: 1\u20132 vCPU</p> <p>RAM: 512 MB (m\u00ednimo) / 1 GB recomendado</p> <p>Disco: 8\u201316 GB</p> <p>Adjunta la ISO de Alpine Linux</p> <p>Configura la interfaz de red (bridge por defecto)</p> <p>Finaliza y arranca la VM</p>"},{"location":"preparacion/instalacion_alpine/#4-instalacion-base-de-alpine-linux","title":"4. Instalaci\u00f3n base de Alpine Linux","text":"<p>En la consola de la VM, inicia sesi\u00f3n como:</p> <p>login: root</p> <p>Ejecuta el instalador:</p> <p>setup-alpine</p> <p>Responde a las preguntas principales:</p> <p>Teclado: es o us</p> <p>Hostname: (ej. alpine-vm)</p> <p>Red: DHCP (recomendado)</p> <p>Zona horaria: Europe/Madrid (o la correspondiente)</p> <p>Repositorio: por defecto</p> <p>Disco: sys</p> <p>Modo: standard</p> <p>Confirma la instalaci\u00f3n y espera a que finalice.</p> <p>Reinicia el sistema:</p> <p>reboot</p>"},{"location":"preparacion/instalacion_alpine/#5-configuracion-del-acceso-por-ssh","title":"5. Configuraci\u00f3n del acceso por SSH","text":"<p>Instala el servidor OpenSSH: <pre><code>apk add openssh\n</code></pre></p> <p>Habilita el servicio: <pre><code>rc-update add sshd\nrc-service sshd start\n</code></pre></p> <p>Verifica que el servicio est\u00e9 activo: <pre><code>rc-service sshd status\n</code></pre></p> <p>(Opcional pero recomendado) Edita la configuraci\u00f3n: <pre><code>vi /etc/ssh/sshd_config\n</code></pre></p> <p>Aseg\u00farate de: <pre><code>PermitRootLogin no\nPasswordAuthentication yes\n</code></pre></p> <p>Reinicia SSH: <pre><code>rc-service sshd restart\n</code></pre></p>"},{"location":"preparacion/instalacion_alpine/#6-creacion-de-un-nuevo-usuario","title":"6. Creaci\u00f3n de un nuevo usuario","text":"<p>Crea un usuario (ejemplo: admin): <pre><code>adduser admin\n</code></pre></p> <p>A\u00f1\u00e1delo a los grupos necesarios: <pre><code>addgroup admin wheel\n</code></pre></p> <p>Verifica: <pre><code>id admin\n</code></pre></p>"},{"location":"preparacion/instalacion_alpine/#7-configuracion-de-doas-o-sudo-en-alpine","title":"7. Configuraci\u00f3n de doas o sudo en Alpine","text":"<p>Alpine puede utilizar sudo o doas. En este despliegue utilizo doas.</p> <p>Instala doas: <pre><code>apk add doas\n</code></pre></p> <p>Edita el archivo de configuraci\u00f3n: <pre><code>vi /etc/doas.conf\n</code></pre></p> <p>A\u00f1ade la siguiente l\u00ednea: <pre><code>permit persist :wheel\n</code></pre></p> <p>Asegura permisos correctos: <pre><code>chmod 0400 /etc/doas.conf\n</code></pre></p> <p>Cambia al nuevo usuario y prueba: <pre><code>su - admin\ndoas apk update\n</code></pre></p>"},{"location":"preparacion/instalacion_alpine/#8-instalacion-de-herramientas-basicas","title":"8. Instalaci\u00f3n de herramientas b\u00e1sicas","text":"<p>Instala utilidades comunes para administraci\u00f3n: <pre><code>doas apk add \\\n  curl \\\n  wget \\\n  vim \\\n  btop \\\n  bash \\\n  git \\\n  ca-certificates\n</code></pre></p> <p>Establece Bash como shell por defecto (opcional): <pre><code>doas chsh -s /bin/bash admin\n</code></pre></p>"},{"location":"preparacion/instalacion_alpine/#9-opcional-instalacion-y-configuracion-de-docker","title":"9. Opcional: Instalaci\u00f3n y configuraci\u00f3n de Docker","text":"<p>Instala Docker: <pre><code>doas apk add docker\n</code></pre></p> <p>Habilita el servicio: <pre><code>doas rc-update add docker\ndoas rc-service docker start\n</code></pre></p> <p>A\u00f1ade el usuario al grupo docker: <pre><code>doas addgroup admin docker\n</code></pre></p> <p>Cierra sesi\u00f3n y vuelve a entrar para aplicar cambios.</p> <p>Verifica la instalaci\u00f3n: <pre><code>docker version\ndocker run hello-world\n</code></pre></p>"},{"location":"preparacion/instalacion_alpine/#10-configuracion-final-recomendada","title":"10. Configuraci\u00f3n final recomendada","text":"<p>Actualiza el sistema: <pre><code>doas apk update &amp;&amp; doas apk upgrade\n</code></pre></p> <p>Configura IP est\u00e1tica (opcional): <pre><code>vi /etc/network/interfaces\n</code></pre></p>"},{"location":"preparacion/instalacion_xo_lite/","title":"\u2699\ufe0f Instalaci\u00f3n y Configuraci\u00f3n del Servidor XCP-ng","text":"<p>Esta gu\u00eda detalla el proceso para establecer la plataforma de virtualizaci\u00f3n utilizando XCP-ng, la interfaz web ligera y moderna para gestionar el hypervisor XCP-ng (o XenServer).  </p> <p>Nota: XCP-ng no es el hypervisor, sino la interfaz de gesti\u00f3n. Primero se instala XCP-ng y luego se accede a su interfaz web integrada.</p>"},{"location":"preparacion/instalacion_xo_lite/#1-prerrequisitos","title":"\ud83d\udccb 1. Prerrequisitos","text":"<p>Antes de comenzar, aseg\u00farate de contar con:</p> <ul> <li>Un servidor f\u00edsico o m\u00e1quina virtual para instalar el hypervisor XCP-ng.</li> <li>Medios de instalaci\u00f3n de XCP-ng (USB o ISO).</li> <li>Acceso a la red local.</li> </ul> <p>Importante</p> <p>Guarda cuidadosamente la contrase\u00f1a de root que establecer\u00e1s durante la instalaci\u00f3n. Ser\u00e1 esencial para la gesti\u00f3n del servidor.</p>"},{"location":"preparacion/instalacion_xo_lite/#2-instalacion-del-hypervisor-xcp-ng","title":"\ud83d\udda5\ufe0f 2. Instalaci\u00f3n del Hypervisor XCP-ng","text":"<p>La instalaci\u00f3n del hypervisor es el paso fundamental para acceder a XCP-ng.</p>"},{"location":"preparacion/instalacion_xo_lite/#3-arranque-desde-el-medio-de-instalacion","title":"3. Arranque desde el medio de instalaci\u00f3n","text":"<p>Inicia el servidor usando la imagen ISO o USB de XCP-ng. El asistente te guiar\u00e1 paso a paso:</p> <ol> <li>Selecciona el idioma y la distribuci\u00f3n del teclado.  </li> <li>Acepta el acuerdo de licencia (EULA).  </li> <li>Selecciona el disco donde se instalar\u00e1 el sistema operativo del hypervisor.  </li> <li>Configura la contrase\u00f1a de root.  </li> <li>Configura la red (se recomienda IP est\u00e1tica para servidores).  </li> <li>Configura la zona horaria.  </li> <li>Finalizaci\u00f3n: el sistema instalar\u00e1 los archivos y te pedir\u00e1 retirar el medio y reiniciar.</li> </ol>"},{"location":"preparacion/instalacion_xo_lite/#4-acceso-inicial-a-la-interfaz-xcp-ng","title":"\ud83c\udf10 4. Acceso Inicial a la Interfaz XCP-ng","text":"<p>Tras reiniciar el servidor:</p>"},{"location":"preparacion/instalacion_xo_lite/#5-obtener-la-direccion-ip","title":"5. Obtener la Direcci\u00f3n IP","text":"<p>La consola de XCP-ng mostrar\u00e1 la IP asignada (ejemplo: <code>192.168.1.10</code>).</p>"},{"location":"preparacion/instalacion_xo_lite/#6-acceder-desde-el-navegador","title":"6. Acceder desde el navegador","text":"<p>Abre un navegador web y navega a:</p> <p>https://192.168.1.10</p> <p>Certificado autofirmado</p> <p>Es probable que tu navegador muestre una advertencia de seguridad. Acepta el certificado para continuar.</p>"},{"location":"preparacion/instalacion_xo_lite/#7-inicio-de-sesion-en-xcp-ng","title":"7. Inicio de sesi\u00f3n en XCP-ng","text":"<ul> <li>Usuario: <code>root</code> </li> <li>Contrase\u00f1a: La que configuraste durante la instalaci\u00f3n de XCP-ng</li> </ul>"},{"location":"preparacion/instalacion_xo_lite/#8-configuracion-post-instalacion-en-xcp-ng","title":"\u2699\ufe0f 8. Configuraci\u00f3n Post-Instalaci\u00f3n en XCP-ng","text":"<p>Dentro de XCP-ng, realiza estas configuraciones b\u00e1sicas:</p>"},{"location":"preparacion/instalacion_xo_lite/#9-configuracion-de-red","title":"9. Configuraci\u00f3n de Red","text":"<ul> <li>Verifica que la interfaz de red (NIC) tenga la IP, m\u00e1scara y gateway correctos.  </li> <li>Configura redes virtuales o VLANs si es necesario.</li> </ul>"},{"location":"preparacion/instalacion_xo_lite/#10-configuracion-de-almacenamiento-storage","title":"10. Configuraci\u00f3n de Almacenamiento (Storage)","text":"<ul> <li>Crea un SR (Storage Repository) para alojar las m\u00e1quinas virtuales.  </li> <li>Ejemplos de opciones comunes:  </li> <li>LVM Local (disco f\u00edsico dedicado)  </li> <li>NFS o SMB (almacenamiento en red)  </li> </ul> <p>Tip</p> <p>Si instalaste en un disco peque\u00f1o y tienes un disco m\u00e1s grande para VMs, crea un SR separado en ese disco para optimizar el rendimiento.</p>"},{"location":"preparacion/instalacion_xo_lite/#11-actualizaciones","title":"11. Actualizaciones","text":"<p>XCP-ng facilita la aplicaci\u00f3n de parches y actualizaciones del hypervisor. Aseg\u00farate de que XCP-ng est\u00e9 actualizado antes de desplegar tus VMs.</p> <p>\u2705 Con la instalaci\u00f3n y configuraci\u00f3n b\u00e1sica de XCP-ng completada, tu hypervisor XCP-ng est\u00e1 listo para administrar m\u00e1quinas virtuales de forma eficiente y segura.</p>"},{"location":"seguridad/cloudflare_tunnel/","title":"2.3. Cloudflare Tunnel","text":"<p>Para cerrar el c\u00edrculo de tu infraestructura en Alpine Linux, el t\u00fanel de Cloudflare (cloudflared) es la pieza clave: es lo que permite que tu servidor sea accesible desde internet sin abrir puertos en tu router y gestionando el SSL de forma autom\u00e1tica.</p> <p>Al no usar contenedores, instalaremos el binario de forma nativa y lo configuraremos como un servicio de OpenRC. \ud83d\udee0\ufe0f Gu\u00eda de Instalaci\u00f3n: Cloudflare Tunnel en Alpine Linux 1. Instalaci\u00f3n del binario</p> <p>Alpine no siempre tiene la versi\u00f3n m\u00e1s reciente en sus repositorios oficiales, por lo que lo ideal es descargar el binario directamente de Cloudflare. Bash</p>"},{"location":"seguridad/cloudflare_tunnel/#instalar-dependencias-necesarias","title":"Instalar dependencias necesarias","text":"<p>apk add libc6-compat</p>"},{"location":"seguridad/cloudflare_tunnel/#descargar-el-binario-arquitectura-x86_64-para-xcp-ng","title":"Descargar el binario (arquitectura x86_64 para XCP-ng)","text":"<p>wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64</p>"},{"location":"seguridad/cloudflare_tunnel/#mover-y-dar-permisos","title":"Mover y dar permisos","text":"<p>chmod +x cloudflared-linux-amd64 mv cloudflared-linux-amd64 /usr/local/bin/cloudflared</p>"},{"location":"seguridad/cloudflare_tunnel/#verificar-instalacion","title":"Verificar instalaci\u00f3n","text":"<p>cloudflared --version</p> <ol> <li>Autenticaci\u00f3n y Creaci\u00f3n del T\u00fanel</li> </ol> <p>Desde la terminal de tu servidor, ejecuta el login (esto te dar\u00e1 un enlace que debes abrir en tu navegador): Bash</p> <p>cloudflared tunnel login</p> <p>Una vez autorizado, crea el t\u00fanel para tu infraestructura: Bash</p>"},{"location":"seguridad/cloudflare_tunnel/#nombre-sugerido-server-labs","title":"Nombre sugerido: server-labs","text":"<p>cloudflared tunnel create server-labs</p> <p>Esto generar\u00e1 un archivo .json en ~/.cloudflared/. Anota el ID del t\u00fanel. 3. Configuraci\u00f3n del archivo config.yml</p> <p>Crea el archivo de configuraci\u00f3n que redirigir\u00e1 el tr\u00e1fico a los puertos de Nginx que definimos antes: Bash</p> <p>mkdir -p /etc/cloudflared vi /etc/cloudflared/config.yml</p> <p>Contenido del archivo: YAML</p> <p>tunnel: TU_TUNNEL_ID credentials-file: /etc/cloudflared/TU_TUNNEL_ID.json</p> <p>ingress:   ## Sitio principal (Hugo)   - hostname: merceponsautora.com     service: http://localhost:8080   - hostname: www.merceponsautora.com     service: http://localhost:8080</p> <p>## Blog (WordPress)   - hostname: blog.merceponsautora.com     service: http://localhost:80</p> <p>## Regla por defecto (404 si no coincide nada)   - service: http_status:404</p> <p>No olvides mover el archivo .json de credenciales a /etc/cloudflared/ para que sea accesible globalmente. 4. Configuraci\u00f3n como Servicio nativo (OpenRC)</p> <p>Para que el t\u00fanel arranque solo al iniciar la VM en XCP-ng, crearemos un script de servicio para Alpine.</p> <pre><code>Crea el archivo de servicio: vi /etc/init.d/cloudflared\n\nPega este contenido:\n</code></pre> <p>Bash</p>"},{"location":"seguridad/cloudflare_tunnel/#sbinopenrc-run","title":"!/sbin/openrc-run","text":"<p>name=\"cloudflared\" description=\"Cloudflare Tunnel\" command=\"/usr/local/bin/cloudflared\" command_args=\"tunnel --config /etc/cloudflared/config.yml run\" command_background=\"yes\" pidfile=\"/run/${RC_SVCNAME}.pid\" output_log=\"/var/log/cloudflared.log\" error_log=\"/var/log/cloudflared.err\"</p> <p>depend() {     need net     after firewall }</p> <pre><code>Da permisos y activa el servicio:\n</code></pre> <p>Bash</p> <p>chmod +x /etc/init.d/cloudflared rc-update add cloudflared default rc-service cloudflared start</p> <ol> <li>Configuraci\u00f3n en el Panel de Cloudflare (DNS)</li> </ol> <p>El \u00faltimo paso es decirle a Cloudflare que use el t\u00fanel para tus dominios. Puedes hacerlo desde la web de Cloudflare o por comando: Bash</p> <p>cloudflared tunnel route dns server-labs merceponsautora.com cloudflared tunnel route dns server-labs blog.merceponsautora.com</p>"},{"location":"web/despliegue_stack_web/","title":"2.2. Configuraci\u00f3n del stack Nginx-MariaDB-WordPress","text":"<p>\ud83d\udcdd Gu\u00eda de Despliegue: WordPress + PHP 8.4 en Alpine Linux</p> <p>Esta gu\u00eda detalla la instalaci\u00f3n del stack din\u00e1mico para blog.merceponsautora.com. 1. Instalaci\u00f3n de PHP 8.4 y Extensiones</p> <p>Alpine es modular. Para que WordPress funcione correctamente, necesitamos el motor de PHP y sus extensiones de procesamiento de im\u00e1genes y base de datos. Bash</p>"},{"location":"web/despliegue_stack_web/#actualizar-repositorios","title":"Actualizar repositorios","text":"<p>apk update</p>"},{"location":"web/despliegue_stack_web/#instalar-php-84-y-modulos-necesarios","title":"Instalar PHP 8.4 y m\u00f3dulos necesarios","text":"<p>apk add php84 php84-fpm php84-mysqli php84-json php84-openssl php84-curl \\     php84-zlib php84-xml php84-phar php84-intl php84-dom php84-xmlreader \\     php84-ctype php84-session php84-mbstring php84-gd php84-iconv</p> <ol> <li>Configuraci\u00f3n de PHP-FPM (El Socket)</li> </ol> <p>Para que coincida con tu configuraci\u00f3n de Nginx, debemos decirle a PHP que escuche en el archivo de socket que definiste: /var/run/php-fpm84.sock.</p> <pre><code>Edita el archivo de configuraci\u00f3n: vi /etc/php84/php-fpm.d/www.conf\n\nModifica estas l\u00edneas:\nIni, TOML\n</code></pre> <p>listen = /var/run/php-fpm84.sock listen.owner = nginx listen.group = nginx listen.mode = 0660</p> <p>Habilita y arranca el servicio: <pre><code>    rc-update add php-fpm84 default\n    rc-service php-fpm84 start\n</code></pre></p> <ol> <li>Base de Datos (MariaDB)</li> </ol> <p>Instalaremos MariaDB de forma nativa para gestionar el contenido del blog. Bash</p>"},{"location":"web/despliegue_stack_web/#instalar-mariadb","title":"Instalar MariaDB","text":"<pre><code>apk add mariadb mariadb-client\n</code></pre>"},{"location":"web/despliegue_stack_web/#configurar-directorios-e-instalar-base-de-datos-inicial","title":"Configurar directorios e instalar base de datos inicial","text":"<p>mysql_install_db --user=mysql --datadir=/var/lib/mysql</p>"},{"location":"web/despliegue_stack_web/#arrancar-servicio","title":"Arrancar servicio","text":"<p>rc-update add mariadb default rc-service mariadb start</p>"},{"location":"web/despliegue_stack_web/#configuracion-de-seguridad-poner-password-de-root","title":"Configuraci\u00f3n de seguridad (poner password de root)","text":"<p>mysql_secure_installation</p> <p>Crear la base de datos para el blog: SQL</p> <p>-- Accede con: mysql -u root -p CREATE DATABASE db_mercepons_blog; CREATE USER 'user_blog'@'localhost' IDENTIFIED BY 'tu_password_seguro'; GRANT ALL PRIVILEGES ON db_mercepons_blog.* TO 'user_blog'@'localhost'; FLUSH PRIVILEGES; EXIT;</p> <ol> <li>Instalaci\u00f3n de WordPress</li> </ol> <p>Descargamos la \u00faltima versi\u00f3n directamente en la ruta que definiste en tu Nginx (/var/www/blog). Bash</p>"},{"location":"web/despliegue_stack_web/#crear-directorio-y-descargar","title":"Crear directorio y descargar","text":"<p>mkdir -p /var/www/blog cd /var/www/blog wget https://wordpress.org/latest.tar.gz tar -xzvf latest.tar.gz --strip-components=1 rm latest.tar.gz</p>"},{"location":"web/despliegue_stack_web/#configurar-permisos-para-que-nginx-y-php-puedan-escribir-subir-fotos-etc","title":"Configurar permisos para que Nginx y PHP puedan escribir (subir fotos, etc)","text":"<p>chown -R nginx:nginx /var/www/blog</p> <ol> <li>Configuraci\u00f3n del wp-config.php</li> </ol> <p>Crea el archivo de configuraci\u00f3n uniendo WordPress con tu base de datos: Bash</p> <p>cp wp-config-sample.php wp-config.php vi wp-config.php</p> <p>Ajusta los valores con el nombre de la DB y el usuario que creamos en el paso 3.</p>"},{"location":"web/nginx_conf/","title":"2.1. Intalaci\u00f3n de Nginx y Hugo","text":"<p>\ud83c\udf10 Arquitectura de Servidor: merceponsautora</p> <p>Esta secci\u00f3n documenta la implementaci\u00f3n nativa en Alpine Linux para la infraestructura de la escritora Merce Pons. Esquema de Flujo de Datos 1. Configuraci\u00f3n de Nginx</p> <p>La configuraci\u00f3n se divide en dos bloques l\u00f3gicos para optimizar el rendimiento y la seguridad. A. Sitio Principal (Hugo - Est\u00e1tico)</p> <pre><code>Puerto: 8080 (Configurado para recibir tr\u00e1fico del T\u00fanel de Cloudflare).\n\nDirectorio ra\u00edz: /var/www/mercepons/public.\n\nEstrategia: Entrega directa de archivos con fallback 404. Al ser Hugo, no requiere procesamiento de lenguaje de lado del servidor, lo que garantiza una carga instant\u00e1nea.\n</code></pre> <p>B. Blog (WordPress - Din\u00e1mico)</p> <pre><code>Puerto: 80.\n\nProcesamiento PHP: Se utiliza PHP-FPM 8.4 a trav\u00e9s de un socket Unix (/var/run/php-fpm84.sock), lo cual es m\u00e1s eficiente que TCP en instalaciones nativas de Alpine.\n\nPar\u00e1metros Cr\u00edticos de Proxy: * fastcgi_param HTTPS on;: Crucial para evitar bucles de redirecci\u00f3n (Mixed Content) ya que SSL termina en Cloudflare.\n\n    HTTP_X_FORWARDED_PROTO: Permite que WordPress reconozca que el usuario final navega de forma segura.\n</code></pre> <ol> <li>Manual de Mantenimiento (SysAdmin) Gesti\u00f3n de Servicios en Alpine (OpenRC)</li> </ol>"},{"location":"web/nginx_conf/#reiniciar-nginx-tras-cambios-en-la-config","title":"Reiniciar Nginx tras cambios en la config","text":"<pre><code>rc-service nginx restart\n</code></pre>"},{"location":"web/nginx_conf/#verificar-que-el-socket-de-php-fpm-este-activo","title":"Verificar que el socket de PHP-FPM est\u00e9 activo","text":"<pre><code>ls -l /var/run/php-fpm84.sock\n</code></pre>"},{"location":"web/nginx_conf/#logs-de-error-en-tiempo-real","title":"Logs de error en tiempo real","text":"<pre><code>tail -f /var/log/nginx/error.log\n</code></pre> <p>Despliegue de Actualizaciones</p> <pre><code>Hugo: Al ejecutar hugo, el contenido se sincroniza con /var/www/mercepons/public.\n\nWordPress: El n\u00facleo y plugins se mantienen mediante el panel o wp-cli nativo en Alpine.\n</code></pre> <ol> <li> <p>Optimizaciones Implementadas</p> <p>Cach\u00e9 Agresiva: Se ha configurado un tiempo de expiraci\u00f3n m\u00e1ximo (expires max) para archivos est\u00e1ticos (js, css, im\u00e1genes), reduciendo la latencia y el ancho de banda del servidor.</p> <p>Seguridad: Bloqueo expl\u00edcito de archivos .htaccess y archivos ocultos, reduciendo la superficie de ataque.</p> <p>Silencio de Logs: Se desactivan los logs para favicon.ico y robots.txt para evitar el llenado innecesario de archivos de log.</p> </li> </ol> <p>\ud83d\udee0\ufe0f Paso 1: Instalaci\u00f3n del paquete</p> <p>Como Alpine es minimalista, primero aseg\u00farate de tener los repositorios actualizados. Bash</p>"},{"location":"web/nginx_conf/#actualizar-indices-de-paquetes","title":"Actualizar \u00edndices de paquetes","text":"<pre><code>apk update\n</code></pre>"},{"location":"web/nginx_conf/#instalar-nginx","title":"Instalar nginx","text":"<pre><code>apk add nginx\n</code></pre> <p>\u2699\ufe0f Paso 2: Gesti\u00f3n del Servicio (OpenRC)</p> <p>Alpine no usa systemd, usa OpenRC. Estos son los comandos que necesitas para que Nginx arranque siempre con el servidor: Bash</p>"},{"location":"web/nginx_conf/#anadir-nginx-al-inicio-automatico","title":"A\u00f1adir Nginx al inicio autom\u00e1tico","text":"<pre><code>rc-update add nginx default\n</code></pre>"},{"location":"web/nginx_conf/#iniciar-el-servicio-por-primera-vez","title":"Iniciar el servicio por primera vez","text":"<pre><code>rc-service nginx start\n</code></pre>"},{"location":"web/nginx_conf/#comprobar-el-estado","title":"Comprobar el estado","text":"<pre><code>rc-service nginx status\n</code></pre> <p>\ud83d\udcc2 Paso 3: Estructura de archivos en Alpine</p> <pre><code>Configuraci\u00f3n principal: /etc/nginx/nginx.conf\n\nConfiguraciones de sitios: /etc/nginx/http.d/ (Aqu\u00ed es donde debes crear tus archivos .conf como el de Merce Pons).\n\nLogs: /var/log/nginx/\n\nDirectorio web por defecto: /var/lib/nginx/html (Aunque t\u00fa est\u00e1s usando /var/www/).\n</code></pre> <p>\ud83d\udc64 Paso 4: Usuarios y Permisos</p> <p>Nginx en Alpine corre bajo el usuario nginx por defecto. Para que pueda leer tus carpetas de Hugo y WordPress: Bash</p>"},{"location":"web/nginx_conf/#asegurate-de-que-el-usuario-nginx-tiene-acceso-a-tus-webs","title":"Aseg\u00farate de que el usuario nginx tiene acceso a tus webs","text":"<pre><code>chown -R nginx:nginx /var/www/mercepons\nchown -R nginx:nginx /var/www/blog\n</code></pre>"},{"location":"web/nginx_conf/#permisos-recomendados-para-directorios-y-archivos","title":"Permisos recomendados para directorios y archivos","text":"<pre><code>find /var/www/ -type d -exec chmod 755 {} \\;\nfind /var/www/ -type f -exec chmod 644 {} \\;\n</code></pre> <p>\ud83d\ude80 Paso 5: Verificaci\u00f3n y Carga</p>"},{"location":"web/nginx_conf/#verificar-sintaxis-esto-te-ahorra-muchos-dolores-de-cabeza","title":"Verificar sintaxis (esto te ahorra muchos dolores de cabeza)","text":"<pre><code>nginx -t\n</code></pre>"},{"location":"web/nginx_conf/#si-el-test-es-exitoso-recarga-sin-cortar-conexiones-activas","title":"Si el test es exitoso, recarga sin cortar conexiones activas","text":"<pre><code>nginx -s reload\n</code></pre>"}]}